<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××¢×¨×›×ª ×§×¨×™××•×ª - ××’×£ ×”××™×—×©×•×‘</title>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary: #2563eb; --primary-dark: #1d4ed8; --primary-light: #dbeafe;
            --success: #10b981; --success-light: #d1fae5;
            --warning: #f59e0b; --warning-light: #fef3c7;
            --danger: #ef4444; --danger-light: #fee2e2;
            --gray-50: #f9fafb; --gray-100: #f3f4f6; --gray-200: #e5e7eb;
            --gray-300: #d1d5db; --gray-400: #9ca3af; --gray-500: #6b7280;
            --gray-600: #4b5563; --gray-700: #374151; --gray-800: #1f2937;
            --shadow: 0 1px 3px rgba(0,0,0,0.1); --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1);
        }
        body { font-family: 'Heebo', sans-serif; background: linear-gradient(135deg, #f0f4ff 0%, #e8f0fe 100%); min-height: 100vh; color: var(--gray-800); }
        
        .header { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%); color: white; padding: 1rem 2rem; box-shadow: var(--shadow-lg); position: sticky; top: 0; z-index: 100; }
        .header-content { max-width: 1400px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; }
        .logo { display: flex; align-items: center; gap: 0.75rem; }
        .logo-icon { width: 45px; height: 45px; background: rgba(255,255,255,0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; }
        .logo-text h1 { font-size: 1.4rem; font-weight: 700; }
        .logo-text span { font-size: 0.85rem; opacity: 0.9; }
        .header-stats { display: flex; gap: 1.5rem; }
        .stat-item { text-align: center; padding: 0.5rem 1rem; background: rgba(255,255,255,0.15); border-radius: 10px; min-width: 80px; }
        .stat-number { font-size: 1.5rem; font-weight: 700; }
        .stat-label { font-size: 0.75rem; opacity: 0.9; }
        .header-time { text-align: left; font-size: 0.9rem; }
        .header-time .date { font-weight: 600; }

        .container { max-width: 1400px; margin: 0 auto; padding: 1.5rem; }
        .nav-tabs { display: flex; gap: 0.5rem; margin-bottom: 1.5rem; background: white; padding: 0.5rem; border-radius: 16px; box-shadow: var(--shadow); flex-wrap: wrap; }
        .nav-tab { padding: 0.75rem 1.5rem; border: none; background: transparent; border-radius: 12px; cursor: pointer; font-family: inherit; font-size: 0.95rem; font-weight: 500; color: var(--gray-600); transition: all 0.2s; display: flex; align-items: center; gap: 0.5rem; }
        .nav-tab:hover { background: var(--gray-100); color: var(--gray-800); }
        .nav-tab.active { background: var(--primary); color: white; }
        .nav-tab .badge { background: var(--danger); color: white; padding: 0.15rem 0.5rem; border-radius: 20px; font-size: 0.75rem; font-weight: 600; }
        .nav-tab.active .badge { background: white; color: var(--primary); }

        .content-section { display: none; }
        .content-section.active { display: block; }
        .card { background: white; border-radius: 16px; box-shadow: var(--shadow); overflow: hidden; margin-bottom: 1.5rem; }
        .card-header { padding: 1.25rem 1.5rem; border-bottom: 1px solid var(--gray-200); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; }
        .card-title { font-size: 1.1rem; font-weight: 600; color: var(--gray-800); display: flex; align-items: center; gap: 0.5rem; }
        .card-body { padding: 1.5rem; }

        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.25rem; }
        .form-group { display: flex; flex-direction: column; gap: 0.5rem; }
        .form-group.full-width { grid-column: 1 / -1; }
        .form-label { font-size: 0.9rem; font-weight: 500; color: var(--gray-700); }
        .form-label .required { color: var(--danger); }
        .form-input, .form-select, .form-textarea { padding: 0.75rem 1rem; border: 2px solid var(--gray-200); border-radius: 10px; font-family: inherit; font-size: 0.95rem; transition: all 0.2s; background: white; }
        .form-input:focus, .form-select:focus, .form-textarea:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px var(--primary-light); }
        .form-select { cursor: pointer; -webkit-appearance: menulist; -moz-appearance: menulist; appearance: menulist; min-height: 44px; }
        .form-select option { padding: 8px; background: white; color: black; }
        .form-textarea { min-height: 120px; resize: vertical; }

        .btn { padding: 0.75rem 1.5rem; border: none; border-radius: 10px; cursor: pointer; font-family: inherit; font-size: 0.95rem; font-weight: 500; display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; transition: all 0.2s; }
        .btn-primary { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: var(--shadow-lg); }
        .btn-success { background: linear-gradient(135deg, var(--success) 0%, #059669 100%); color: white; }
        .btn-danger { background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%); color: white; }
        .btn-outline { background: transparent; border: 2px solid var(--gray-300); color: var(--gray-700); }
        .btn-outline:hover { border-color: var(--primary); color: var(--primary); }
        .btn-sm { padding: 0.5rem 1rem; font-size: 0.85rem; }
        .btn-icon { width: 36px; height: 36px; padding: 0; border-radius: 8px; }
        .btn-delete { background: var(--danger); color: white; width: 28px; height: 28px; border-radius: 50%; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1rem; transition: all 0.2s; }
        .btn-delete:hover { background: #dc2626; transform: scale(1.1); }

        .priority-tag { padding: 0.35rem 0.75rem; border-radius: 20px; font-size: 0.8rem; font-weight: 600; display: inline-flex; align-items: center; gap: 0.35rem; }
        .priority-critical { background: var(--danger-light); color: var(--danger); }
        .priority-high { background: #fef3c7; color: #b45309; }
        .priority-medium { background: var(--primary-light); color: var(--primary); }
        .priority-low { background: var(--success-light); color: var(--success); }

        .status-tag { padding: 0.35rem 0.75rem; border-radius: 20px; font-size: 0.8rem; font-weight: 600; }
        .status-open { background: var(--danger-light); color: var(--danger); }
        .status-progress { background: var(--warning-light); color: #b45309; }
        .status-resolved { background: var(--success-light); color: var(--success); }
        .status-closed { background: var(--gray-200); color: var(--gray-600); }

        .tickets-container { overflow-x: auto; }
        .tickets-table { width: 100%; border-collapse: collapse; }
        .tickets-table th { background: var(--gray-50); padding: 1rem; text-align: right; font-weight: 600; font-size: 0.85rem; color: var(--gray-600); border-bottom: 2px solid var(--gray-200); }
        .tickets-table td { padding: 1rem; border-bottom: 1px solid var(--gray-100); vertical-align: middle; }
        .tickets-table tr:hover { background: var(--gray-50); }
        .ticket-id { font-weight: 700; color: var(--primary); font-family: monospace; font-size: 0.95rem; }
        .ticket-subject { font-weight: 500; color: var(--gray-800); max-width: 300px; }
        .ticket-requester { display: flex; align-items: center; gap: 0.5rem; }
        .avatar { width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%); color: white; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 0.85rem; }
        .phone-link { color: var(--primary); text-decoration: none; direction: ltr; unicode-bidi: bidi-override; }
        .phone-link:hover { text-decoration: underline; }
        .action-buttons { display: flex; gap: 0.5rem; align-items: center; }

        .filters-bar { display: flex; gap: 1rem; flex-wrap: wrap; align-items: center; }
        .search-box { position: relative; flex: 1; min-width: 250px; }
        .search-box input { width: 100%; padding: 0.75rem 1rem 0.75rem 2.5rem; border: 2px solid var(--gray-200); border-radius: 10px; font-family: inherit; font-size: 0.95rem; }
        .search-box input:focus { outline: none; border-color: var(--primary); }
        .search-box::before { content: "ğŸ”"; position: absolute; right: 1rem; top: 50%; transform: translateY(-50%); }
        .filter-select { padding: 0.75rem 1rem; border: 2px solid var(--gray-200); border-radius: 10px; font-family: inherit; font-size: 0.95rem; min-width: 150px; background: white; }

        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 1000; padding: 1rem; }
        .modal-overlay.active { display: flex; }
        .modal { background: white; border-radius: 20px; width: 100%; max-width: 700px; max-height: 90vh; overflow-y: auto; box-shadow: var(--shadow-lg); }
        .modal-header { padding: 1.5rem; border-bottom: 1px solid var(--gray-200); display: flex; justify-content: space-between; align-items: center; }
        .modal-title { font-size: 1.25rem; font-weight: 700; }
        .modal-close { width: 40px; height: 40px; border: none; background: var(--gray-100); border-radius: 10px; cursor: pointer; font-size: 1.25rem; display: flex; align-items: center; justify-content: center; }
        .modal-close:hover { background: var(--gray-200); }
        .modal-body { padding: 1.5rem; }
        .modal-footer { padding: 1.5rem; border-top: 1px solid var(--gray-200); display: flex; justify-content: flex-start; gap: 1rem; }

        .detail-section { margin-bottom: 1.5rem; }
        .detail-section h3 { font-size: 1rem; font-weight: 600; color: var(--gray-700); margin-bottom: 0.75rem; padding-bottom: 0.5rem; border-bottom: 2px solid var(--gray-100); }
        .detail-content { background: var(--gray-50); padding: 1rem; border-radius: 10px; line-height: 1.6; }
        .ticket-meta { display: flex; gap: 1rem; flex-wrap: wrap; color: var(--gray-500); font-size: 0.9rem; margin-bottom: 1rem; }

        .timeline { position: relative; padding-right: 2rem; }
        .timeline::before { content: ''; position: absolute; right: 7px; top: 0; bottom: 0; width: 2px; background: var(--gray-200); }
        .timeline-item { position: relative; padding-bottom: 1.5rem; }
        .timeline-item::before { content: ''; position: absolute; right: -2rem; top: 0.25rem; width: 16px; height: 16px; border-radius: 50%; background: white; border: 3px solid var(--primary); }
        .timeline-item.comment::before { border-color: var(--success); }
        .timeline-item.status::before { border-color: var(--warning); }
        .timeline-content { background: var(--gray-50); padding: 1rem; border-radius: 10px; }
        .timeline-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; }
        .timeline-author { font-weight: 600; color: var(--gray-800); }
        .timeline-date { font-size: 0.85rem; color: var(--gray-500); }
        .timeline-text { color: var(--gray-700); line-height: 1.5; }

        .reminders-list { display: flex; flex-direction: column; gap: 1rem; }
        .reminder-item { display: flex; align-items: center; gap: 1rem; padding: 1rem; background: var(--gray-50); border-radius: 12px; border-right: 4px solid var(--warning); }
        .reminder-item.overdue { border-right-color: var(--danger); background: var(--danger-light); }
        .reminder-icon { width: 48px; height: 48px; border-radius: 12px; background: var(--warning-light); display: flex; align-items: center; justify-content: center; font-size: 1.5rem; }
        .reminder-content { flex: 1; }
        .reminder-title { font-weight: 600; margin-bottom: 0.25rem; }
        .reminder-meta { font-size: 0.85rem; color: var(--gray-500); }
        .reminder-actions { display: flex; gap: 0.5rem; }

        .dashboard-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1.5rem; }
        .stat-card { background: white; border-radius: 16px; padding: 1.5rem; box-shadow: var(--shadow); display: flex; align-items: center; gap: 1rem; }
        .stat-card-icon { width: 56px; height: 56px; border-radius: 14px; display: flex; align-items: center; justify-content: center; font-size: 1.75rem; }
        .stat-card-icon.blue { background: var(--primary-light); }
        .stat-card-icon.red { background: var(--danger-light); }
        .stat-card-icon.yellow { background: var(--warning-light); }
        .stat-card-icon.green { background: var(--success-light); }
        .stat-card-content h3 { font-size: 1.75rem; font-weight: 700; color: var(--gray-800); }
        .stat-card-content p { font-size: 0.9rem; color: var(--gray-500); }

        .charts-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 1.5rem; }
        .chart-container { height: 250px; display: flex; align-items: flex-end; gap: 0.75rem; padding: 1rem 0; }
        .chart-bar { flex: 1; background: linear-gradient(to top, var(--primary) 0%, #60a5fa 100%); border-radius: 8px 8px 0 0; position: relative; min-height: 20px; }
        .chart-bar span { position: absolute; bottom: -25px; left: 50%; transform: translateX(-50%); font-size: 0.75rem; color: var(--gray-500); white-space: nowrap; }
        .chart-bar .value { position: absolute; top: -25px; left: 50%; transform: translateX(-50%); font-size: 0.85rem; font-weight: 600; color: var(--gray-700); }

        .category-list { display: flex; flex-direction: column; gap: 1rem; }
        .category-item { display: flex; align-items: center; gap: 1rem; }
        .category-label { width: 120px; font-size: 0.9rem; color: var(--gray-600); }
        .category-bar { flex: 1; height: 24px; background: var(--gray-100); border-radius: 12px; overflow: hidden; }
        .category-fill { height: 100%; border-radius: 12px; }
        .category-fill.hardware { background: linear-gradient(90deg, #3b82f6, #60a5fa); }
        .category-fill.software { background: linear-gradient(90deg, #10b981, #34d399); }
        .category-fill.network { background: linear-gradient(90deg, #f59e0b, #fbbf24); }
        .category-fill.security { background: linear-gradient(90deg, #ef4444, #f87171); }
        .category-fill.other { background: linear-gradient(90deg, #8b5cf6, #a78bfa); }
        .category-value { width: 50px; text-align: left; font-weight: 600; color: var(--gray-700); }

        .contacts-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1rem; }
        .contact-card { background: var(--gray-50); border-radius: 12px; padding: 1.25rem; display: flex; align-items: center; gap: 1rem; transition: all 0.2s; position: relative; cursor: pointer; }
        .contact-card:hover { background: var(--gray-100); transform: translateY(-2px); }
        .contact-avatar { width: 50px; height: 50px; border-radius: 50%; background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%); color: white; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 1.1rem; }
        .contact-info { flex: 1; }
        .contact-info h4 { font-weight: 600; margin-bottom: 0.25rem; }
        .contact-info p { font-size: 0.85rem; color: var(--gray-500); }
        .contact-info a { color: var(--primary); text-decoration: none; font-weight: 500; }
        .contact-delete { position: absolute; top: 10px; left: 10px; }

        .contact-actions-modal { background: white; border-radius: 16px; padding: 1.5rem; min-width: 280px; }
        .contact-actions-modal h3 { margin-bottom: 1rem; text-align: center; }
        .contact-action-btn { display: flex; align-items: center; gap: 1rem; padding: 1rem; margin-bottom: 0.5rem; border-radius: 10px; border: 2px solid var(--gray-200); cursor: pointer; transition: all 0.2s; background: white; width: 100%; font-family: inherit; font-size: 1rem; }
        .contact-action-btn:hover { border-color: var(--primary); background: var(--primary-light); }
        .contact-action-btn .icon { font-size: 1.5rem; }

        .empty-state { text-align: center; padding: 3rem; color: var(--gray-500); }
        .empty-state-icon { font-size: 4rem; margin-bottom: 1rem; opacity: 0.5; }
        .empty-state h3 { font-size: 1.25rem; color: var(--gray-700); margin-bottom: 0.5rem; }

        .toast-container { position: fixed; top: 1rem; left: 1rem; z-index: 2000; display: flex; flex-direction: column; gap: 0.5rem; }
        .toast { background: white; padding: 1rem 1.5rem; border-radius: 12px; box-shadow: var(--shadow-lg); display: flex; align-items: center; gap: 0.75rem; animation: slideIn 0.3s ease; max-width: 350px; }
        @keyframes slideIn { from { transform: translateX(-100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        .toast.success { border-right: 4px solid var(--success); }
        .toast.error { border-right: 4px solid var(--danger); }
        .toast.warning { border-right: 4px solid var(--warning); }
        
        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 107, 107, 0.7); }
            50% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(255, 107, 107, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 107, 107, 0); }
        }

        .info-box { background: var(--primary-light); border: 2px solid var(--primary); border-radius: 12px; padding: 1.5rem; margin-bottom: 1.5rem; }
        .info-box h4 { color: var(--primary-dark); margin-bottom: 0.5rem; }
        .info-box p { color: var(--gray-700); font-size: 0.9rem; line-height: 1.6; }
        .info-box code { background: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-family: monospace; }

        .email-template { background: var(--gray-50); border: 1px solid var(--gray-300); border-radius: 10px; padding: 1rem; margin: 1rem 0; font-family: monospace; font-size: 0.85rem; white-space: pre-wrap; }

        @media (max-width: 768px) {
            .header-content { flex-direction: column; text-align: center; }
            .header-stats { flex-wrap: wrap; justify-content: center; }
            .nav-tabs { justify-content: center; }
            .tickets-table { font-size: 0.85rem; }
            .tickets-table th, .tickets-table td { padding: 0.75rem 0.5rem; }
            .action-buttons { flex-direction: column; }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">ğŸ–¥ï¸</div>
                <div class="logo-text">
                    <h1>××¢×¨×›×ª ×§×¨×™××•×ª</h1>
                    <span>××’×£ ×”××™×—×©×•×‘ - ××—×œ×§×ª ×¡×™×¡×˜×</span>
                </div>
            </div>
            <div class="header-stats">
                <div class="stat-item"><div class="stat-number" id="totalTickets">0</div><div class="stat-label">×¡×”"×› ×§×¨×™××•×ª</div></div>
                <div class="stat-item"><div class="stat-number" id="openTickets">0</div><div class="stat-label">×¤×ª×•×—×•×ª</div></div>
                <div class="stat-item"><div class="stat-number" id="urgentTickets">0</div><div class="stat-label">×“×—×•×¤×•×ª</div></div>
            </div>
            <div class="header-time"><div class="date" id="currentDate"></div><div id="currentTime"></div></div>
        </div>
    </header>

    <main class="container">
        <nav class="nav-tabs">
            <button class="nav-tab active" onclick="showSection('welcome', this)">ğŸ  ×¨××©×™</button>
            <button class="nav-tab" onclick="showSection('technicians', this)">ğŸ‘¨â€ğŸ’» ×˜×›× ××™×</button>
            <button class="nav-tab" onclick="showSection('new-ticket', this)">â• ×§×¨×™××” ×—×“×©×”</button>
            <button class="nav-tab" onclick="showSection('tickets', this)">ğŸ« ×§×¨×™××•×ª <span class="badge" id="ticketsBadge">0</span></button>
            <button class="nav-tab" onclick="showSection('reminders', this)">â° ×ª×–×›×•×¨×•×ª <span class="badge" id="remindersBadge">0</span></button>
            <button class="nav-tab" onclick="showSection('contacts', this)">ğŸ‘¥ ×× ×©×™ ×§×©×¨</button>
            <button class="nav-tab" onclick="showSection('history', this)">ğŸ“œ ×”×™×¡×˜×•×¨×™×”</button>
            <button class="nav-tab" onclick="showSection('email-tickets', this)">ğŸ“§ ×§×¨×™××•×ª ×‘××™×™×œ</button>
            <button class="nav-tab" onclick="showSection('settings', this)">âš™ï¸ ×”×’×“×¨×•×ª</button>
            <button class="nav-tab" onclick="showSection('dashboard', this)">ğŸ“Š ×œ×•×— ×‘×§×¨×”</button>
        </nav>

        <section id="welcome" class="content-section active">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">ğŸ  ×‘×¨×•×›×™× ×”×‘××™× ×œ××¢×¨×›×ª ×§×¨×™××•×ª IT</h2>
                </div>
                <div class="card-body">
                    <div style="text-align: center; margin-bottom: 2rem;">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">ğŸ–¥ï¸</div>
                        <h3 style="color: var(--primary); margin-bottom: 1rem;">××¢×¨×›×ª × ×™×”×•×œ ×§×¨×™××•×ª ×©×™×¨×•×ª</h3>
                        <p style="font-size: 1.1rem; color: var(--gray-600); max-width: 600px; margin: 0 auto;">
                            ××¢×¨×›×ª ××§×¦×•×¢×™×ª ×œ× ×™×”×•×œ ×§×¨×™××•×ª ×©×™×¨×•×ª ×‘××—×œ×§×ª IT - ×¤×ª×™×—×”, ××¢×§×‘ ×•×˜×™×¤×•×œ ×‘×™×¢×™×œ×•×ª ××§×¡×™××œ×™×ª
                        </p>
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; margin-bottom: 2rem;">
                        <div class="info-box" style="background: linear-gradient(135deg, var(--primary-light) 0%, #f8fafc 100%); border: 2px solid var(--primary);">
                            <h4 style="color: var(--primary-dark); display: flex; align-items: center; gap: 0.5rem;">
                                ğŸš€ ×”×ª×—×œ×” ××”×™×¨×”
                            </h4>
                            <ol style="margin: 1rem 0; padding-right: 1rem;">
                                <li><strong>×”×•×¡×£ ×˜×›× ××™×</strong> - ×¢×‘×•×¨ ×œ×œ×©×•× ×™×ª "×˜×›× ××™×" ×•×”×•×¡×£ ××ª ×¦×•×•×ª ×”-IT</li>
                                <li><strong>×¤×ª×— ×§×¨×™××”</strong> - ×¢×‘×•×¨ ×œ"×§×¨×™××” ×—×“×©×”" ×•×¦×•×¨ ×§×¨×™××ª ×‘×“×™×§×”</li>
                                <li><strong>× ×”×œ ×§×¨×™××•×ª</strong> - ×¢×‘×•×¨ ×œ"×§×¨×™××•×ª" ×œ×¢×§×•×‘ ×•×œ×¢×“×›×Ÿ ×¡×˜×˜×•×¡</li>
                            </ol>
                        </div>

                        <div class="info-box" style="background: linear-gradient(135deg, var(--success-light) 0%, #f8fafc 100%); border: 2px solid var(--success);">
                            <h4 style="color: var(--success); display: flex; align-items: center; gap: 0.5rem;">
                                âœ¨ ×™×›×•×œ×•×ª ×”××¢×¨×›×ª
                            </h4>
                            <ul style="margin: 1rem 0; padding-right: 1rem;">
                                <li>ğŸ“ ×¤×ª×™×—×ª ×§×¨×™××•×ª ××”×™×¨×” ×•×§×œ×”</li>
                                <li>ğŸ‘¨â€ğŸ’» ×”×§×¦××ª ×§×¨×™××•×ª ×œ×˜×›× ××™×</li>
                                <li>â° ×ª×–×›×•×¨×•×ª ××•×˜×•××˜×™×•×ª</li>
                                <li>ğŸ“Š ×“×•×—×•×ª ×•×”×™×¡×˜×•×¨×™×” ××¤×•×¨×˜×ª</li>
                                <li>ğŸ“§ ×©×œ×™×—×ª ××™×™×œ×™× ×•×§×™×©×•×¨×™×</li>
                                <li>ğŸ’¾ ×©××™×¨×” ××§×•××™×ª ×××™× ×”</li>
                            </ul>
                        </div>
                    </div>

                    <div class="card" style="background: var(--gray-50); border: 2px dashed var(--gray-300); margin-bottom: 2rem;">
                        <div class="card-header" style="background: transparent; border: none;">
                            <h3 style="color: var(--gray-700); display: flex; align-items: center; gap: 0.5rem;">
                                ğŸ¯ ××“×¨×™×š ××”×™×¨ - ×¦×¢×“×™× ×¨××©×•× ×™×
                            </h3>
                        </div>
                        <div class="card-body" style="padding-top: 0;">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                                <div style="text-align: center; padding: 1rem;">
                                    <div style="width: 60px; height: 60px; background: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; font-size: 1.5rem; font-weight: bold;">1</div>
                                    <h4 style="margin-bottom: 0.5rem;">×”×•×¡×£ ×˜×›× ××™×</h4>
                                    <p style="color: var(--gray-600); font-size: 0.9rem;">×œ×—×¥ ×¢×œ "×˜×›× ××™×" ×•×”×•×¡×£ ××ª ×—×‘×¨×™ ×”×¦×•×•×ª</p>
                                    <button class="btn btn-outline btn-sm" onclick="showSection('technicians', document.querySelectorAll('.nav-tab')[1])" style="margin-top: 0.5rem;">ğŸ‘¨â€ğŸ’» ×œ×˜×›× ××™×</button>
                                </div>
                                
                                <div style="text-align: center; padding: 1rem;">
                                    <div style="width: 60px; height: 60px; background: var(--success); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; font-size: 1.5rem; font-weight: bold;">2</div>
                                    <h4 style="margin-bottom: 0.5rem;">×¤×ª×— ×§×¨×™××” ×¨××©×•× ×”</h4>
                                    <p style="color: var(--gray-600); font-size: 0.9rem;">×¦×•×¨ ×§×¨×™××ª ×‘×“×™×§×” ×œ×•×•×“× ×©×”×›×œ ×¢×•×‘×“</p>
                                    <button class="btn btn-outline btn-sm" onclick="showSection('new-ticket', document.querySelectorAll('.nav-tab')[2])" style="margin-top: 0.5rem;">â• ×§×¨×™××” ×—×“×©×”</button>
                                </div>
                                
                                <div style="text-align: center; padding: 1rem;">
                                    <div style="width: 60px; height: 60px; background: var(--warning); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; font-size: 1.5rem; font-weight: bold;">3</div>
                                    <h4 style="margin-bottom: 0.5rem;">×¢×§×•×‘ ×•× ×”×œ</h4>
                                    <p style="color: var(--gray-600); font-size: 0.9rem;">×‘×“×•×§ ×¡×˜×˜×•×¡ ×•×˜×¤×œ ×‘×§×¨×™××•×ª</p>
                                    <button class="btn btn-outline btn-sm" onclick="showSection('tickets', document.querySelectorAll('.nav-tab')[3])" style="margin-top: 0.5rem;">ğŸ« ×§×¨×™××•×ª</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="info-box" style="background: linear-gradient(135deg, var(--warning-light) 0%, #fefdf8 100%); border: 2px solid var(--warning);">
                        <h4 style="color: #b45309; display: flex; align-items: center; gap: 0.5rem;">
                            ğŸ’¡ ×˜×™×¤×™× ×œ×©×™××•×© ×™×¢×™×œ
                        </h4>
                        <ul style="margin: 1rem 0; padding-right: 1rem; columns: 2; column-gap: 2rem;">
                            <li>×”×•×¡×£ ×˜×›× ××™× ×œ×¤× ×™ ×¤×ª×™×—×ª ×§×¨×™××•×ª</li>
                            <li>×”×©×ª××© ×‘×¢×“×™×¤×•×™×•×ª (×§×¨×™×˜×™/×’×‘×•×”/×‘×™× ×•× ×™/× ××•×š)</li>
                            <li>×”×§×¦×” ×§×¨×™××•×ª ×œ×˜×›× ××™× ×”××ª××™××™×</li>
                            <li>×¢×“×›×Ÿ ×¡×˜×˜×•×¡ ×§×¨×™××•×ª ×‘××•×¤×Ÿ ×§×‘×•×¢</li>
                            <li>×”×•×¡×£ ×ª×–×›×•×¨×•×ª ×œ×§×¨×™××•×ª ×—×©×•×‘×•×ª</li>
                            <li>×”×©×ª××© ×‘×”×™×¡×˜×•×¨×™×” ×œ×“×•×—×•×ª</li>
                            <li>×”×’×“×¨ ×”×•×“×¢×•×ª ××™×™×œ ××•×˜×•××˜×™×•×ª</li>
                            <li>×‘×“×•×§ ×œ×•×— ×”×‘×§×¨×” ×œ×¡×˜×˜×™×¡×˜×™×§×•×ª</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <section id="dashboard" class="content-section">
            <div class="dashboard-stats">
                <div class="stat-card"><div class="stat-card-icon blue">ğŸ“‹</div><div class="stat-card-content"><h3 id="statTotal">0</h3><p>×¡×”"×› ×§×¨×™××•×ª</p></div></div>
                <div class="stat-card"><div class="stat-card-icon red">ğŸ”´</div><div class="stat-card-content"><h3 id="statOpen">0</h3><p>×§×¨×™××•×ª ×¤×ª×•×—×•×ª</p></div></div>
                <div class="stat-card"><div class="stat-card-icon yellow">ğŸŸ¡</div><div class="stat-card-content"><h3 id="statProgress">0</h3><p>×‘×˜×™×¤×•×œ</p></div></div>
                <div class="stat-card"><div class="stat-card-icon green">ğŸŸ¢</div><div class="stat-card-content"><h3 id="statResolved">0</h3><p>×˜×•×¤×œ×• ×”×—×•×“×©</p></div></div>
            </div>
            <div class="charts-grid">
                <div class="card"><div class="card-header"><h2 class="card-title">ğŸ“ˆ ×§×¨×™××•×ª ×œ×¤×™ ×™×•×</h2></div><div class="card-body"><div class="chart-container" id="weeklyChart"></div></div></div>
                <div class="card"><div class="card-header"><h2 class="card-title">ğŸ“Š ×”×ª×¤×œ×’×•×ª ×œ×¤×™ ×§×˜×’×•×¨×™×”</h2></div><div class="card-body"><div class="category-list" id="categoryChart"></div></div></div>
            </div>
            <div class="card"><div class="card-header"><h2 class="card-title">ğŸ”¥ ×§×¨×™××•×ª ×“×—×•×¤×•×ª</h2></div><div class="card-body"><div id="urgentTicketsList"></div></div></div>
        </section>

        <section id="new-ticket" class="content-section">
            <div class="card">
                <div class="card-header"><h2 class="card-title">â• ×¤×ª×™×—×ª ×§×¨×™××” ×—×“×©×”</h2></div>
                <div class="card-body">
                    <form id="newTicketForm" novalidate>
                        <div class="form-grid">
                            <div class="form-group"><label class="form-label">×©× ×¤×•×ª×— ×”×§×¨×™××” <span class="required">*</span></label><input type="text" class="form-input" id="requesterName" required></div>
                            <div class="form-group"><label class="form-label">××—×œ×§×” <span class="required">*</span></label><select class="form-select" id="department" required onchange="if(this.value==='××—×¨'){document.getElementById('departmentOther').style.display='block'}else{document.getElementById('departmentOther').style.display='none';document.getElementById('departmentOther').value=''}"><option value="">×‘×—×¨...</option><option value="×”× ×”×œ×”">×”× ×”×œ×”</option><option value="×›×¡×¤×™×">×›×¡×¤×™×</option><option value="××©××‘×™ ×× ×•×©">××©××‘×™ ×× ×•×©</option><option value="×©×™×•×•×§">×©×™×•×•×§</option><option value="××›×™×¨×•×ª">××›×™×¨×•×ª</option><option value="×ª×¤×¢×•×œ">×ª×¤×¢×•×œ</option><option value="×¤×™×ª×•×—">×¤×™×ª×•×—</option><option value="××—×¨">××—×¨</option></select><input type="text" class="form-input" id="departmentOther" placeholder="×”×–×Ÿ ×©× ××—×œ×§×”..." style="display:none;margin-top:0.5rem"></div>
                            <div class="form-group"><label class="form-label">×˜×œ×¤×•×Ÿ <span class="required">*</span></label><input type="tel" class="form-input" id="phone" placeholder="050-0000000" required></div>
                            <div class="form-group"><label class="form-label">×“×•×"×œ <span class="required">*</span></label><input type="email" class="form-input" id="email" required></div>
                            <div class="form-group full-width"><label class="form-label">× ×•×©× <span class="required">*</span></label><input type="text" class="form-input" id="subject" required></div>
                            <div class="form-group"><label class="form-label">×§×˜×’×•×¨×™×” <span class="required">*</span></label><select class="form-select" id="category" required><option value="">×‘×—×¨...</option><option value="hardware">×—×•××¨×”</option><option value="software">×ª×•×›× ×”</option><option value="network">×¨×©×ª</option><option value="security">××‘×˜×—×”</option><option value="other">××—×¨</option></select></div>
                            <div class="form-group"><label class="form-label">×¢×“×™×¤×•×ª</label><select class="form-select" id="priority"><option value="low">× ××•×š</option><option value="medium" selected>×‘×™× ×•× ×™</option><option value="high">×’×‘×•×”</option><option value="critical">×§×¨×™×˜×™</option></select></div>
                            <div class="form-group"><label class="form-label">×”×§×¦××” ×œ×˜×›× ××™</label><select class="form-select" id="assignee"><option value="">×œ× ×”×•×§×¦×”</option></select></div>
                            <div class="form-group"><label class="form-label">×ª×–×›×•×¨×ª</label><input type="datetime-local" class="form-input" id="reminder"></div>
                            <div class="form-group full-width"><label class="form-label">×ª×™××•×¨ <span class="required">*</span></label><textarea class="form-textarea" id="description" required placeholder="×ª××¨ ××ª ×”×‘×¢×™×”..."></textarea></div>
                        </div>
                        <div style="margin-top:1.5rem;display:flex;gap:1rem;flex-wrap:wrap;">
                            <button type="button" class="btn btn-primary" onclick="submitTicket()">ğŸ“¤ ×¤×ª×— ×§×¨×™××”</button>
                            <button type="button" class="btn btn-success" onclick="openAddReminderModal()">â° ×”×•×¡×£ ×ª×–×›×•×¨×ª</button>
                            <button type="button" class="btn btn-outline" onclick="sendEmailToUser()">ğŸ“§ ×©×œ×— ××™×™×œ ×œ××©×ª××©</button>
                            <button type="reset" class="btn btn-outline">ğŸ”„ × ×§×”</button>
                        </div>
                    </form>
                </div>
            </div>
        </section>

        <section id="tickets" class="content-section">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">ğŸ« ×¨×©×™××ª ×§×¨×™××•×ª</h2>
                    <div class="filters-bar">
                        <div class="search-box"><input type="text" id="searchTickets" placeholder="×—×™×¤×•×©..." oninput="filterTickets()"></div>
                        <select class="filter-select" id="filterStatus" onchange="filterTickets()"><option value="">×›×œ ×”×¡×˜×˜×•×¡×™×</option><option value="open">×¤×ª×•×—</option><option value="progress">×‘×˜×™×¤×•×œ</option><option value="resolved">×˜×•×¤×œ</option></select>
                        <select class="filter-select" id="filterPriority" onchange="filterTickets()"><option value="">×›×œ ×”×¢×“×™×¤×•×™×•×ª</option><option value="critical">×§×¨×™×˜×™</option><option value="high">×’×‘×•×”</option><option value="medium">×‘×™× ×•× ×™</option><option value="low">× ××•×š</option></select>
                    </div>
                </div>
                <div class="card-body"><div class="tickets-container"><table class="tickets-table"><thead><tr><th>××¡'</th><th>× ×•×©×</th><th>×¤×•×ª×—</th><th>×˜×œ×¤×•×Ÿ</th><th>×§×˜×’×•×¨×™×”</th><th>×¢×“×™×¤×•×ª</th><th>×¡×˜×˜×•×¡</th><th>×˜×›× ××™</th><th>×ª××¨×™×š</th><th>×¤×¢×•×œ×•×ª</th></tr></thead><tbody id="ticketsTableBody"></tbody></table></div></div>
            </div>
        </section>

        <section id="reminders" class="content-section">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">â° ×ª×–×›×•×¨×•×ª</h2>
                    <div style="display: flex; gap: 0.5rem;">
                        <button class="btn btn-warning btn-sm" onclick="checkDelayedTickets()" title="×‘×“×•×§ ×§×¨×™××•×ª ×©× ×ª×§×¢×•">ğŸš¨ ×‘×“×•×§ ×¢×™×›×•×‘×™×</button>
                        <button class="btn btn-primary btn-sm" onclick="openAddReminderModal()">â• ×”×•×¡×£</button>
                    </div>
                </div>
                <div class="card-body"><div class="reminders-list" id="remindersList"></div></div>
            </div>
        </section>

        <section id="technicians" class="content-section">
            <div class="card">
                <div class="card-header"><h2 class="card-title">ğŸ‘¨â€ğŸ’» ×˜×›× ××™×</h2><button class="btn btn-primary btn-sm" onclick="openAddTechnicianModal()">â• ×”×•×¡×£ ×˜×›× ××™</button></div>
                <div class="card-body">
                    <div class="info-box" style="margin-bottom:1rem;">
                        <p>×›××Ÿ ×× ×”×œ×™× ××ª ×¨×©×™××ª ×”×˜×›× ××™× ×©××¤×©×¨ ×œ×”×§×¦×•×ª ×œ×”× ×§×¨×™××•×ª</p>
                    </div>
                    <div class="contacts-grid" id="techniciansGrid"></div>
                </div>
            </div>
        </section>

        <section id="contacts" class="content-section">
            <div class="card">
                <div class="card-header"><h2 class="card-title">ğŸ‘¥ ×× ×©×™ ×§×©×¨</h2><button class="btn btn-primary btn-sm" onclick="openAddContactModal()">â• ×”×•×¡×£</button></div>
                <div class="card-body"><div class="contacts-grid" id="contactsGrid"></div></div>
            </div>
        </section>

        <section id="history" class="content-section">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">ğŸ“œ ×”×™×¡×˜×•×¨×™×”</h2>
                    <div class="filters-bar">
                        <input type="date" class="form-input" id="historyFrom" onchange="filterHistory()">
                        <span>×¢×“</span>
                        <input type="date" class="form-input" id="historyTo" onchange="filterHistory()">
                        <button class="btn btn-outline btn-sm" onclick="exportHistoryToExcel()">ğŸ“Š ×™×™×¦×•× ×œ××§×¡×œ</button>
                        <button class="btn btn-outline btn-sm" onclick="saveHistoryAsFile()">ğŸ’¾ ×©××™×¨×”</button>
                        <button class="btn btn-outline btn-sm" onclick="sendHistoryByEmail()">ğŸ“§ ×©×œ×— ×‘××™×™×œ</button>
                    </div>
                </div>
                <div class="card-body"><div class="tickets-container"><table class="tickets-table"><thead><tr><th>××¡'</th><th>× ×•×©×</th><th>×¤×•×ª×—</th><th>× ×¤×ª×—</th><th>× ×¡×’×¨</th><th>×–××Ÿ ×˜×™×¤×•×œ</th><th>×¤×¢×•×œ×•×ª</th></tr></thead><tbody id="historyTableBody"></tbody></table></div></div>
            </div>
        </section>

        <section id="email-tickets" class="content-section">
            <div class="card">
                <div class="card-header"><h2 class="card-title">ğŸ“§ ×¤×ª×™×—×ª ×§×¨×™××•×ª ×‘××™×™×œ</h2></div>
                <div class="card-body">
                    <div class="info-box" style="background: #e8f5e8; border-left: 4px solid #27ae60; margin-bottom: 1.5rem;">
                        <h4 style="margin: 0 0 1rem; color: #27ae60;">ğŸ”— ×§×™×©×•×¨ ×œ×¤×ª×™×—×ª ×¤× ×™×” ×‘××™×™×œ</h4>
                        <p style="margin: 0 0 1rem;">×©×ª×¤×• ××ª ×”×§×™×©×•×¨ ×”×–×” ×¢× ×”×¢×•×‘×“×™× ×›×“×™ ×©×™×•×›×œ×• ×œ×¤×ª×•×— ×§×¨×™××•×ª ×—×“×©×•×ª:</p>
                        <div style="background: white; padding: 1rem; border-radius: 8px; border: 1px solid #ddd; margin: 1rem 0; font-family: monospace; font-size: 0.9rem; color: #666; word-break: break-all;">
                            https://docs.google.com/forms/d/e/1FAIpQLSfPG-sw7LNKrThP99gZfLKMDD1AKTsXqaBO0A9MJDJ4C3-oyw/viewform?usp=header
                        </div>
                        <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                            <button class="btn btn-primary btn-sm" onclick="shareFormByEmail()">ğŸ“§ ×©×ª×£ ×‘××™×™×œ</button>
                            <button class="btn btn-outline btn-sm" onclick="shareFormByWhatsApp()">ğŸ“± ×©×ª×£ ×‘×•×•×˜×¡××¤</button>
                        </div>
                    </div>

                    <div class="info-box" style="background: #e6f3ff; border-left: 4px solid #2196f3; margin-bottom: 1.5rem;">
                        <h4 style="margin: 0 0 0.5rem; color: #2196f3;">ğŸ”” ×”×ª×¨××•×ª ××•×˜×•××˜×™×•×ª</h4>
                        <p style="margin: 0 0 1rem;">×›×“×™ ×œ×§×‘×œ ×”×ª×¨××•×ª ×›×©××’×™×¢×•×ª ×§×¨×™××•×ª ×—×“×©×•×ª ×-Google Forms:</p>
                        <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                            <button class="btn btn-primary btn-sm" onclick="requestNotifications()">ğŸ”” ××¤×©×¨ ×”×ª×¨××•×ª</button>
                            <button class="btn btn-sm" onclick="testSystemNotification()" style="background: #ffb3d9; color: #333; border: 1px solid #ff99cc;">ğŸ§ª ×‘×“×•×§ ×”×ª×¨××”</button>
                            <button class="btn btn-success btn-sm" onclick="simulateNewTicket()">ğŸ­ ×¡××œ×¥ ×§×¨×™××” ×—×“×©×”</button>
                        </div>
                        <div id="notificationStatus" style="margin-top: 1rem; padding: 0.75rem; background: rgba(255,255,255,0.7); border-radius: 6px; font-size: 0.9rem;"></div>
                        
                        <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; margin-top: 1rem; border-left: 4px solid #28a745;">
                            <h5 style="margin: 0 0 0.5rem; color: #28a745;">ğŸ§ª ×‘×“×™×§×ª ×”×—×™×‘×•×¨:</h5>
                            <ol style="margin: 0; padding-right: 1.5rem; font-size: 0.9rem;">
                                <li><strong>×œ×—×¦×• "ğŸ”” ××¤×©×¨ ×”×ª×¨××•×ª"</strong> ×•××©×¨×• ×‘×“×¤×“×¤×Ÿ</li>
                                <li><strong>×œ×—×¦×• "ğŸ§ª ×‘×“×•×§ ×”×ª×¨××”"</strong> - ×××•×¨×” ×œ×”×•×¤×™×¢ ×”×ª×¨××” ×¢× ×¦×œ×™×œ</li>
                                <li><strong>×œ×—×¦×• "ğŸ­ ×¡××œ×¥ ×§×¨×™××” ×—×“×©×”"</strong> - ×‘×“×™×§×” ××œ××” ×©×œ ×”××¢×¨×›×ª</li>
                                <li>×× ×”×›×œ ×¢×•×‘×“ - <strong>××œ××• ×˜×•×¤×¡ ×××™×ª×™</strong> ×•×ª×§×‘×œ×• ×”×ª×¨××”!</li>
                            </ol>
                        </div>
                    </div>




                    <h3 style="margin: 2rem 0 1rem;">ğŸ“¬ ×§×¨×™××•×ª ×©×”×ª×§×‘×œ×• ×‘××™×™×œ</h3>
                    <div id="emailTicketsList">
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸ“­</div>
                            <h3>××™×Ÿ ×§×¨×™××•×ª ×—×“×©×•×ª ×‘××™×™×œ</h3>
                            <p>×§×¨×™××•×ª ×©×™×ª×§×‘×œ×• ×‘××™×™×œ ×™×•×¤×™×¢×• ×›××Ÿ</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="settings" class="content-section">
            <div class="card">
                <div class="card-header"><h2 class="card-title">âš™ï¸ ×”×’×“×¨×•×ª</h2></div>
                <div class="card-body">
                    <div class="form-grid">
                        <div class="form-group"><label class="form-label">×©× ×”××¨×’×•×Ÿ</label><input type="text" class="form-input" id="orgName" value="××’×£ ×”××™×—×©×•×‘" onchange="saveSettings()"></div>
                        <div class="form-group"><label class="form-label">×§×™×“×•××ª ×§×¨×™××”</label><input type="text" class="form-input" id="ticketPrefix" value="IT" onchange="saveSettings()"></div>
                        <div class="form-group"><label class="form-label">××™×™×œ ××¢×¨×›×ª</label><input type="email" class="form-input" id="systemEmail" placeholder="helpdesk@company.com" onchange="saveSettings()"></div>
                        <div class="form-group"><label class="form-label">××™×™×œ ×œ×§×‘×œ×ª ×§×¨×™××•×ª</label><input type="email" class="form-input" id="helpdeskEmail" placeholder="tickets@company.com" onchange="saveSettings();"></div>
                        <div class="form-group"><label class="form-label">×–××Ÿ ×œ×©×œ×™×—×ª ×ª×–×›×•×¨×ª (×©×¢×•×ª)</label><input type="number" class="form-input" id="reminderHours" value="168" min="1" onchange="saveSettings()"></div>
                    </div>
                    
                    <div class="info-box" style="margin-top: 2rem;">
                        <h4>ğŸ’¡ ×”×¡×‘×¨ ×¢×œ ×™×™×¦×•× ×•×™×™×‘×•×</h4>
                        <p><strong>×™×™×¦×•×:</strong> ×©×•××¨ ××ª ×›×œ ×”× ×ª×•× ×™× ×©×œ ×”××¢×¨×›×ª (×§×¨×™××•×ª, ×× ×©×™ ×§×©×¨, ×ª×–×›×•×¨×•×ª, ×”×’×“×¨×•×ª) ×œ×§×•×‘×¥ JSON ×©×ª×•×›×œ ×œ×©××•×¨ ×‘××—×©×‘ ×©×œ×š ×›×’×™×‘×•×™.</p>
                        <p><strong>×™×™×‘×•×:</strong> ×××¤×©×¨ ×œ×˜×¢×•×Ÿ × ×ª×•× ×™× ××§×•×‘×¥ JSON ×©×™×¦××ª ×‘×¢×‘×¨ - ×©×™××•×©×™ ×œ×©×—×–×•×¨ ×’×™×‘×•×™ ××• ×”×¢×‘×¨×ª × ×ª×•× ×™× ×œ××—×©×‘ ××—×¨.</p>
                    </div>
                    
                    <div style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--gray-200);">
                        <h3 style="margin-bottom: 1rem;">× ×™×”×•×œ × ×ª×•× ×™×</h3>
                        <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                            <button class="btn btn-outline" onclick="exportAllData()">ğŸ“¥ ×™×™×¦×•× × ×ª×•× ×™× (×’×™×‘×•×™)</button>
                            <button class="btn btn-outline" onclick="importData()">ğŸ“¤ ×™×™×‘×•× × ×ª×•× ×™× (×©×—×–×•×¨)</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <div class="modal-overlay" id="ticketModal">
        <div class="modal">
            <div class="modal-header"><h2 class="modal-title" id="modalTicketId">×§×¨×™××” #</h2><button class="modal-close" onclick="closeModal('ticketModal')">âœ•</button></div>
            <div class="modal-body" id="ticketModalBody"></div>
            <div class="modal-footer"><button class="btn btn-primary" onclick="saveTicketChanges()">ğŸ’¾ ×©××•×¨</button><button class="btn btn-outline" onclick="closeModal('ticketModal')">×¡×’×•×¨</button></div>
        </div>
    </div>

    <div class="modal-overlay" id="reminderModal">
        <div class="modal">
            <div class="modal-header"><h2 class="modal-title">â• ×ª×–×›×•×¨×ª ×—×“×©×”</h2><button class="modal-close" onclick="closeModal('reminderModal')">âœ•</button></div>
            <div class="modal-body">
                <div class="form-grid">
                    <div class="form-group full-width"><label class="form-label">×›×•×ª×¨×ª <span class="required">*</span></label><input type="text" class="form-input" id="reminderTitle"></div>
                    <div class="form-group"><label class="form-label">×ª××¨×™×š ×•×©×¢×” <span class="required">*</span></label><input type="datetime-local" class="form-input" id="reminderDateTime"></div>
                    <div class="form-group"><label class="form-label">×§×¨×™××” ×§×©×•×¨×”</label><select class="form-select" id="reminderTicket"><option value="">×œ×œ×</option></select></div>
                    <div class="form-group full-width"><label class="form-label">×”×¢×¨×•×ª</label><textarea class="form-textarea" id="reminderNotes" rows="3"></textarea></div>
                </div>
            </div>
            <div class="modal-footer"><button class="btn btn-primary" onclick="saveReminder()">ğŸ’¾ ×©××•×¨</button><button class="btn btn-outline" onclick="closeModal('reminderModal')">×‘×™×˜×•×œ</button></div>
        </div>
    </div>

    <div class="modal-overlay" id="contactModal">
        <div class="modal">
            <div class="modal-header"><h2 class="modal-title">â• ××™×© ×§×©×¨ ×—×“×©</h2><button class="modal-close" onclick="closeModal('contactModal')">âœ•</button></div>
            <div class="modal-body">
                <div class="form-grid">
                    <div class="form-group"><label class="form-label">×©× <span class="required">*</span></label><input type="text" class="form-input" id="contactName"></div>
                    <div class="form-group"><label class="form-label">×ª×¤×§×™×“ <span class="required">*</span></label><input type="text" class="form-input" id="contactRole"></div>
                    <div class="form-group"><label class="form-label">×§×˜×’×•×¨×™×” <span class="required">*</span></label><select class="form-select" id="contactCategory" onchange="if(this.value==='××—×¨'){document.getElementById('contactCategoryOther').style.display='block'}else{document.getElementById('contactCategoryOther').style.display='none';document.getElementById('contactCategoryOther').value=''}"><option value="">×‘×—×¨...</option><option value="×˜×›× ××™">×˜×›× ××™</option><option value="×× ×”×œ">×× ×”×œ</option><option value="×ª××™×›×”">×ª××™×›×”</option><option value="××—×¨">××—×¨</option></select><input type="text" class="form-input" id="contactCategoryOther" placeholder="×”×–×Ÿ ×§×˜×’×•×¨×™×”..." style="display:none;margin-top:0.5rem"></div>
                    <div class="form-group"><label class="form-label">×˜×œ×¤×•×Ÿ <span class="required">*</span></label><input type="tel" class="form-input" id="contactPhone"></div>
                    <div class="form-group"><label class="form-label">×“×•×"×œ</label><input type="email" class="form-input" id="contactEmail"></div>
                </div>
            </div>
            <div class="modal-footer"><button class="btn btn-primary" onclick="saveContact()">ğŸ’¾ ×©××•×¨</button><button class="btn btn-outline" onclick="closeModal('contactModal')">×‘×™×˜×•×œ</button></div>
        </div>
    </div>

    <div class="modal-overlay" id="contactActionsModal">
        <div class="modal" style="max-width: 350px;">
            <div class="modal-header"><h2 class="modal-title" id="contactActionName">×¤×¢×•×œ×•×ª</h2><button class="modal-close" onclick="closeModal('contactActionsModal')">âœ•</button></div>
            <div class="modal-body">
                <button class="contact-action-btn" onclick="contactAction('call')"><span class="icon">ğŸ“</span>×”×ª×§×©×¨</button>
                <button class="contact-action-btn" onclick="contactAction('whatsapp')"><span class="icon">ğŸ’¬</span>×•×•××˜×¡××¤</button>
                <button class="contact-action-btn" onclick="contactAction('email')"><span class="icon">ğŸ“§</span>×©×œ×— ××™×™×œ</button>
                <button class="contact-action-btn" onclick="contactAction('sms')"><span class="icon">ğŸ’Œ</span>×©×œ×— SMS</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="technicianModal">
        <div class="modal">
            <div class="modal-header"><h2 class="modal-title">ğŸ‘¨â€ğŸ’» ×”×•×¡×¤×ª ×˜×›× ××™</h2><button class="modal-close" onclick="closeModal('technicianModal')">âœ•</button></div>
            <div class="modal-body">
                <div class="form-grid">
                    <div class="form-group"><label class="form-label">×©× ××œ× <span class="required">*</span></label><input type="text" class="form-input" id="techName"></div>
                    <div class="form-group"><label class="form-label">×ª×¤×§×™×“</label><input type="text" class="form-input" id="techRole" placeholder="×˜×›× ××™ ××—×©×‘×™×"></div>
                    <div class="form-group"><label class="form-label">×˜×œ×¤×•×Ÿ <span class="required">*</span></label><input type="tel" class="form-input" id="techPhone"></div>
                    <div class="form-group"><label class="form-label">×“×•×"×œ <span class="required">*</span></label><input type="email" class="form-input" id="techEmail"></div>
                    <div class="form-group full-width"><label class="form-label">×”×ª××—×•×ª</label><input type="text" class="form-input" id="techSpecialty" placeholder="×—×•××¨×”, ×ª×•×›× ×”, ×¨×©×ª×•×ª..."></div>
                </div>
            </div>
            <div class="modal-footer"><button class="btn btn-primary" onclick="saveTechnician()">ğŸ’¾ ×©××•×¨ ×˜×›× ××™</button><button class="btn btn-outline" onclick="closeModal('technicianModal')">×‘×™×˜×•×œ</button></div>
        </div>
    </div>

    <div class="modal-overlay" id="assignModal">
        <div class="modal" style="max-width: 450px;">
            <div class="modal-header">
                <h2 class="modal-title">ğŸ‘¨â€ğŸ’» ×”×§×¦××ª ×˜×›× ××™</h2>
                <button class="modal-close" onclick="closeModal('assignModal')">âœ•</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 1rem; color: var(--gray-600);">×§×¨×™××”: <strong id="assignTicketId"></strong></p>
                <div class="form-group">
                    <label class="form-label">×‘×—×¨ ×˜×›× ××™:</label>
                    <select class="form-select" id="assignTechSelect" style="width: 100%; padding: 0.75rem; border: 2px solid var(--gray-200); border-radius: 8px;">
                        <option value="">×œ× ×”×•×§×¦×”</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="saveAssignmentSimple()">ğŸ’¾ ×©××•×¨ ×”×§×¦××”</button>
                <button class="btn btn-outline" onclick="closeModal('assignModal')">×‘×™×˜×•×œ</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="assignModal">
        <div class="modal" style="max-width: 450px;">
            <div class="modal-header"><h2 class="modal-title">×”×§×¦××ª ×˜×›× ××™ ×œ×§×¨×™××”</h2><button class="modal-close" onclick="closeModal('assignModal')">âœ•</button></div>
            <div class="modal-body">
                <div style="margin-bottom: 1rem;">
                    <label class="form-label">×‘×—×¨ ×˜×›× ××™:</label>
                </div>
                
                <div id="assignButtons">
                    <!-- ×›×¤×ª×•×¨×™× ×™×™×•×•×¦×¨×• ×›××Ÿ -->
                </div>
                
                <div id="assignResult" style="margin-top: 1rem; padding: 1rem; background: var(--primary-light); border-radius: 8px; display: none;">
                    <strong>× ×‘×—×¨: </strong><span id="assignSelected"></span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="saveAssignment()">ğŸ’¾ ×”×§×¦×” ×˜×›× ××™</button>
                <button class="btn btn-outline" onclick="closeModal('assignModal')">×‘×™×˜×•×œ</button>
            </div>
        </div>
    </div>

    <div class="toast-container" id="toastContainer"></div>

    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script>
    <script>
        // ============================================
        // ğŸ’¾ ××¢×¨×›×ª ×©××™×¨×” ××§×•××™×ª
        // ============================================
        var SCRIPT_URL = ''; // ×¨×™×§ = ×¢×‘×•×“×” ××§×•××™×ª ×‘×œ×‘×“
        // ============================================

        var tickets = JSON.parse(localStorage.getItem('hd_tickets')) || [];
        var contacts = JSON.parse(localStorage.getItem('hd_contacts')) || [];
        var technicians = JSON.parse(localStorage.getItem('hd_technicians')) || [];
        var reminders = JSON.parse(localStorage.getItem('hd_reminders')) || [];
        var settings = JSON.parse(localStorage.getItem('hd_settings')) || {orgName:'××’×£ ×”××™×—×©×•×‘',ticketPrefix:'IT',systemEmail:'',helpdeskEmail:'',reminderHours:168};
        var technicianEmails = JSON.parse(localStorage.getItem('hd_tech_emails')) || [];
        var ticketCounter = parseInt(localStorage.getItem('hd_counter')) || 1000;
        var currentTicketId = null;
        var currentContactForAction = null;

        // Global click handler for all delete buttons
        document.addEventListener('click', function(e) {
            var target = e.target;
            
            // Delete ticket
            if (target.hasAttribute('data-delete-ticket')) {
                e.stopPropagation();
                e.preventDefault();
                var id = target.getAttribute('data-delete-ticket');
                tickets = tickets.filter(function(t) { return t.id !== id; });
                saveTickets();
                renderAll();
                showToast('success', '× ××—×§');
                return;
            }
            
            // Delete contact
            if (target.hasAttribute('data-delete-contact')) {
                e.stopPropagation();
                e.preventDefault();
                var id = target.getAttribute('data-delete-contact');
                contacts = contacts.filter(function(c) { return c.id !== id; });
                saveContacts();
                renderContacts();
                showToast('success', '××™×© ×§×©×¨ × ××—×§');
                return;
            }
            
            // Delete technician
            if (target.hasAttribute('data-delete-technician')) {
                e.stopPropagation();
                e.preventDefault();
                var id = target.getAttribute('data-delete-technician');
                technicians = technicians.filter(function(t) { return t.id !== id; });
                saveTechnicians();
                renderTechnicians();
                populateAssigneeDropdown();
                showToast('success', '×˜×›× ××™ × ××—×§');
                return;
            }
            
            // Delete reminder
            if (target.hasAttribute('data-delete-reminder')) {
                e.stopPropagation();
                e.preventDefault();
                var id = target.getAttribute('data-delete-reminder');
                reminders = reminders.filter(function(r) { return r.id !== id; });
                saveReminders();
                renderReminders();
                updateStats();
                return;
            }
            
            // Delete from history
            if (target.hasAttribute('data-delete-history')) {
                e.stopPropagation();
                e.preventDefault();
                var id = target.getAttribute('data-delete-history');
                tickets = tickets.filter(function(t) { return t.id !== id; });
                saveTickets();
                renderHistory();
                renderAll();
                showToast('success', '× ××—×§');
                return;
            }
            
            // Open contact actions
            if (target.hasAttribute('data-contact-card')) {
                var id = target.getAttribute('data-contact-card');
                openContactActions(id);
                return;
            }
        });

        document.addEventListener('DOMContentLoaded', function() {
            updateDateTime(); 
            setInterval(updateDateTime, 1000);
            
            // Ensure date/time elements are visible
            setTimeout(() => {
                const dateEl = document.getElementById('currentDate');
                const timeEl = document.getElementById('currentTime');
                if (dateEl && !dateEl.textContent.trim()) {
                    updateDateTime(); // Force update if empty
                }
            }, 100);
            
            // ×‘×“×•×§ × ×ª×•× ×™× ×—×“×©×™× ×-Google Forms ×›×œ 5 ×©× ×™×•×ª
            checkForNewFormsData(); // ×‘×“×™×§×” ×¨××©×•× ×” ××™×™×“×™×ª
            setInterval(checkForNewFormsData, 5000);
            
            // ×˜×¢×Ÿ ×”×’×“×¨×•×ª ×”×ª×¨××•×ª - ××•×›×Ÿ ×œ×¢×ª×™×“
            
            // Load data from local storage
            if (SCRIPT_URL) {
                loadAllData().then(function() {
                    renderAll();
                    loadSettings();
                    populateAssigneeDropdown();
                    
                    renderTechnicians();
                    checkDelayedTickets();
                    
                    // Check for overdue tickets after 2 seconds
                    setTimeout(checkDelayedTickets, 2000);
                }).catch(function(error) {
                    console.error('×©×’×™××” ×‘×˜×¢×™× ×ª × ×ª×•× ×™×:', error);
                    // Fallback to localStorage
                    renderAll();
                    loadSettings();
                    populateAssigneeDropdown();
                    
                    renderTechnicians();
                    checkDelayedTickets();
                });
            } else {
                // Use localStorage
                renderAll();
                loadSettings();
                populateAssigneeDropdown();
                
                renderTechnicians();
                checkDelayedTickets();
            }
            
            setInterval(checkDelayedTickets, 3600000);
        });

        function updateDateTime() {
            const now = new Date();
            document.getElementById('currentDate').textContent = now.toLocaleDateString('he-IL', {weekday:'long',year:'numeric',month:'long',day:'numeric'});
            document.getElementById('currentTime').textContent = now.toLocaleTimeString('he-IL');
        }

        function showSection(sectionId, tab) {
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
            if (tab) tab.classList.add('active');
            renderAll();
        }

        function renderAll() { 
            updateStats(); 
            renderDashboard(); 
            renderTickets(); 
            renderReminders(); 
            renderContacts(); 
            renderHistory(); 
        }

        function updateStats() {
            const open = tickets.filter(t => t.status === 'open').length;
            const progress = tickets.filter(t => t.status === 'progress').length;
            const newTickets = tickets.filter(t => t.status === 'new').length;
            const urgent = tickets.filter(t => ['critical','high'].includes(t.priority) && t.status !== 'closed').length;
            const resolved = tickets.filter(t => t.status === 'resolved' || t.status === 'closed').length;

            document.getElementById('totalTickets').textContent = tickets.length;
            document.getElementById('openTickets').textContent = open + progress + newTickets;
            document.getElementById('urgentTickets').textContent = urgent;
            document.getElementById('ticketsBadge').textContent = open + progress + newTickets;
            document.getElementById('remindersBadge').textContent = reminders.filter(r => !r.completed).length;
            document.getElementById('statTotal').textContent = tickets.length;
            document.getElementById('statOpen').textContent = open;
            document.getElementById('statProgress').textContent = progress;
            document.getElementById('statResolved').textContent = resolved;
        }

        function renderDashboard() { renderWeeklyChart(); renderCategoryChart(); renderUrgentTickets(); }

        function renderWeeklyChart() {
            const container = document.getElementById('weeklyChart');
            const days = ['×','×‘','×’','×“','×”','×•','×©'];
            const today = new Date();
            const weekData = [];
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today); date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                const count = tickets.filter(t => t.createdAt && t.createdAt.split('T')[0] === dateStr).length;
                weekData.push({day: days[date.getDay()], count});
            }
            const maxCount = Math.max(...weekData.map(d => d.count), 1);
            container.innerHTML = weekData.map(d => `<div class="chart-bar" style="height:${(d.count/maxCount)*100}%"><span class="value">${d.count}</span><span>${d.day}</span></div>`).join('');
        }

        function renderCategoryChart() {
            const container = document.getElementById('categoryChart');
            const cats = {hardware:{label:'×—×•××¨×”',count:0},software:{label:'×ª×•×›× ×”',count:0},network:{label:'×¨×©×ª',count:0},security:{label:'××‘×˜×—×”',count:0},other:{label:'××—×¨',count:0}};
            tickets.forEach(t => { if(cats[t.category]) cats[t.category].count++; });
            const total = tickets.length || 1;
            container.innerHTML = Object.entries(cats).map(([k,v]) => `<div class="category-item"><span class="category-label">${v.label}</span><div class="category-bar"><div class="category-fill ${k}" style="width:${(v.count/total)*100}%"></div></div><span class="category-value">${v.count}</span></div>`).join('');
        }

        function renderUrgentTickets() {
            const container = document.getElementById('urgentTicketsList');
            const urgent = tickets.filter(t => ['critical','high'].includes(t.priority) && ['open','progress'].includes(t.status)).slice(0,5);
            if (urgent.length === 0) { container.innerHTML = `<div class="empty-state"><div class="empty-state-icon">âœ…</div><h3>××™×Ÿ ×§×¨×™××•×ª ×“×—×•×¤×•×ª</h3></div>`; return; }
            container.innerHTML = `<table class="tickets-table"><tbody>${urgent.map(t => `<tr><td><span class="ticket-id">${t.id}</span></td><td>${t.subject}</td><td>${t.requesterName}</td><td><span class="priority-tag priority-${t.priority}">${getPriorityLabel(t.priority)}</span></td><td><button class="btn btn-sm btn-outline" onclick="openTicketModal('${t.id}')">×¦×¤×™×™×”</button></td></tr>`).join('')}</tbody></table>`;
        }

        function renderTickets() {
            var tbody = document.getElementById('ticketsTableBody');
            var filtered = tickets.filter(function(t) { return t.status !== 'closed'; });
            var search = document.getElementById('searchTickets').value.toLowerCase();
            var status = document.getElementById('filterStatus').value;
            var priority = document.getElementById('filterPriority').value;
            if (search) filtered = filtered.filter(function(t) { return t.subject.toLowerCase().includes(search) || t.requesterName.toLowerCase().includes(search) || t.id.toLowerCase().includes(search); });
            if (status) filtered = filtered.filter(function(t) { return t.status === status; });
            if (priority) filtered = filtered.filter(function(t) { return t.priority === priority; });
            filtered.sort(function(a,b) { return ({critical:0,high:1,medium:2,low:3})[a.priority] - ({critical:0,high:1,medium:2,low:3})[b.priority]; });
            if (filtered.length === 0) { tbody.innerHTML = '<tr><td colspan="10"><div class="empty-state"><div class="empty-state-icon">ğŸ“­</div><h3>×œ× × ××¦××• ×§×¨×™××•×ª</h3></div></td></tr>'; return; }
            var html = '';
            for (var i = 0; i < filtered.length; i++) {
                var t = filtered[i];
                html += '<tr>';
                html += '<td><span class="ticket-id">' + t.id + '</span></td>';
                html += '<td class="ticket-subject">' + t.subject + '</td>';
                html += '<td><div class="ticket-requester"><div class="avatar">' + getInitials(t.requesterName) + '</div><div>' + t.requesterName + '<br><small style="color:var(--gray-500)">' + t.department + '</small></div></div></td>';
                html += '<td><a href="tel:' + t.phone + '" class="phone-link">' + t.phone + '</a></td>';
                html += '<td>' + getCategoryLabel(t.category) + '</td>';
                html += '<td><span class="priority-tag priority-' + t.priority + '">' + getPriorityLabel(t.priority) + '</span></td>';
                html += '<td><span class="status-tag status-' + t.status + '">' + getStatusLabel(t.status) + '</span></td>';
                html += '<td>' + (t.assignee || '<span style="color:var(--gray-400)">×œ× ×”×•×§×¦×”</span>') + '</td>';
                html += '<td>' + formatDate(t.createdAt) + '</td>';
                html += '<td><div class="action-buttons">';
                html += '<button class="btn btn-icon btn-outline" onclick="openTicketModal(\'' + t.id + '\')" title="×¦×¤×™×™×”">ğŸ‘ï¸</button>';
                html += '<button class="btn btn-icon btn-outline" onclick="openAssignModal(\'' + t.id + '\')" title="×”×§×¦×” ×˜×›× ××™">ğŸ‘¨â€ğŸ’»</button>';
                html += '<button class="btn btn-icon btn-outline" onclick="window.location.href=\'tel:' + t.phone + '\'" title="×”×ª×§×©×¨">ğŸ“</button>';
                html += '<button class="btn-delete" data-delete-ticket="' + t.id + '" title="××—×§">âœ•</button>';
                html += '</div></td>';
                html += '</tr>';
            }
            tbody.innerHTML = html;
        }

        function filterTickets() { renderTickets(); }

        function renderReminders() {
            var container = document.getElementById('remindersList');
            var now = new Date();
            var sorted = reminders.filter(function(r) { return !r.completed; }).sort(function(a,b) { return new Date(a.dateTime) - new Date(b.dateTime); });
            if (sorted.length === 0) { container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ””</div><h3>××™×Ÿ ×ª×–×›×•×¨×•×ª</h3></div>'; return; }
            var html = '';
            for (var i = 0; i < sorted.length; i++) {
                var r = sorted[i];
                var rd = new Date(r.dateTime); 
                var overdue = rd < now;
                html += '<div class="reminder-item ' + (overdue ? 'overdue' : '') + '">';
                html += '<div class="reminder-icon">' + (overdue ? 'âš ï¸' : 'â°') + '</div>';
                html += '<div class="reminder-content"><div class="reminder-title">' + r.title + '</div>';
                html += '<div class="reminder-meta">' + formatDateTime(r.dateTime) + (r.ticketId ? ' â€¢ ' + r.ticketId : '') + '</div></div>';
                html += '<div class="reminder-actions">';
                html += '<button class="btn btn-sm btn-outline" onclick="sendReminderEmail(\'' + r.id + '\')">ğŸ“§ ×©×œ×—</button>';
                html += '<button class="btn btn-sm btn-success" onclick="completeReminder(\'' + r.id + '\')">âœ“ ×¡××Ÿ ×›×˜×•×¤×œ</button>';
                html += '<button class="btn-delete" data-delete-reminder="' + r.id + '">âœ•</button>';
                html += '</div></div>';
            }
            container.innerHTML = html;
        }

        function renderContacts() {
            var grid = document.getElementById('contactsGrid');
            if (contacts.length === 0) {
                grid.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ‘¥</div><h3>××™×Ÿ ×× ×©×™ ×§×©×¨</h3><p>×”×•×¡×£ ××™×© ×§×©×¨ ×—×“×©</p></div>';
                return;
            }
            var html = '';
            for (var i = 0; i < contacts.length; i++) {
                var c = contacts[i];
                html += '<div class="contact-card" data-contact-card="' + c.id + '">';
                html += '<button class="btn-delete contact-delete" data-delete-contact="' + c.id + '" title="××—×§">âœ•</button>';
                html += '<div class="contact-avatar">' + getInitials(c.name) + '</div>';
                html += '<div class="contact-info">';
                html += '<h4>' + c.name + '</h4>';
                html += '<p>' + c.role + (c.category ? ' â€¢ ' + c.category : '') + '</p>';
                html += '<span style="color: var(--primary)">' + c.phone + '</span>';
                html += '</div></div>';
            }
            grid.innerHTML = html;
        }

        function renderHistory() {
            var tbody = document.getElementById('historyTableBody');
            var closed = tickets.filter(function(t) { return t.status === 'closed'; });
            var from = document.getElementById('historyFrom').value;
            var to = document.getElementById('historyTo').value;
            if (from) closed = closed.filter(function(t) { return new Date(t.closedAt) >= new Date(from); });
            if (to) closed = closed.filter(function(t) { return new Date(t.closedAt) <= new Date(to+'T23:59:59'); });
            closed.sort(function(a,b) { return new Date(b.closedAt) - new Date(a.closedAt); });
            if (closed.length === 0) { tbody.innerHTML = '<tr><td colspan="7"><div class="empty-state"><div class="empty-state-icon">ğŸ“‹</div><h3>××™×Ÿ ×”×™×¡×˜×•×¨×™×”</h3></div></td></tr>'; return; }
            var html = '';
            for (var i = 0; i < closed.length; i++) {
                var t = closed[i];
                var diff = Math.round((new Date(t.closedAt) - new Date(t.createdAt)) / 3600000);
                html += '<tr>';
                html += '<td><span class="ticket-id">' + t.id + '</span></td>';
                html += '<td>' + t.subject + '</td>';
                html += '<td>' + t.requesterName + '</td>';
                html += '<td>' + formatDate(t.createdAt) + '</td>';
                html += '<td>' + formatDate(t.closedAt) + '</td>';
                html += '<td>' + (diff < 24 ? diff + ' ×©×¢×•×ª' : Math.round(diff/24) + ' ×™××™×') + '</td>';
                html += '<td><div class="action-buttons">';
                html += '<button class="btn btn-sm btn-outline" onclick="openTicketModal(\'' + t.id + '\')">×¦×¤×™×™×”</button>';
                html += '<button class="btn-delete" data-delete-history="' + t.id + '" title="××—×§">âœ•</button>';
                html += '</div></td>';
                html += '</tr>';
            }
            tbody.innerHTML = html;
        }

        function filterHistory() { renderHistory(); }

        function submitTicket() {
            const requesterName = document.getElementById('requesterName').value.trim();
            let department = document.getElementById('department').value;
            const departmentOther = document.getElementById('departmentOther').value.trim();
            if (department === '××—×¨' && departmentOther) department = departmentOther;
            const phone = document.getElementById('phone').value.trim();
            const email = document.getElementById('email').value.trim();
            const subject = document.getElementById('subject').value.trim();
            const category = document.getElementById('category').value;
            const description = document.getElementById('description').value.trim();

            if (!requesterName || !department || !phone || !email || !subject || !category || !description) {
                showToast('error', '× × ×œ××œ× ××ª ×›×œ ×”×©×“×•×ª ×”××¡×•×× ×™×');
                return;
            }
            if (document.getElementById('department').value === '××—×¨' && !departmentOther) {
                showToast('error', '× × ×œ×”×–×™×Ÿ ×©× ××—×œ×§×”');
                return;
            }

            ticketCounter++;
            const ticket = {
                id: settings.ticketPrefix + '-' + ticketCounter,
                requesterName: requesterName,
                department: department,
                phone: phone,
                email: email,
                subject: subject,
                category: category,
                priority: document.getElementById('priority').value,
                assignee: document.getElementById('assignee').value,
                description: description,
                status: 'open',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString(),
                timeline: [{type:'created',author:'××¢×¨×›×ª',text:'×§×¨×™××” × ×¤×ª×—×”',timestamp:new Date().toISOString()}]
            };

            const rem = document.getElementById('reminder').value;
            if (rem) { 
                reminders.push({id:'r'+Date.now(),title:'××¢×§×‘: '+ticket.subject,dateTime:rem,ticketId:ticket.id,completed:false}); 
                saveReminders(); 
            }

            tickets.push(ticket);
            saveTickets();
            localStorage.setItem('hd_counter', ticketCounter);
            showToast('success', '×§×¨×™××” × ×¤×ª×—×” ×‘×”×¦×œ×—×”!', ticket.id);
            document.getElementById('newTicketForm').reset();
            document.getElementById('departmentOther').style.display = 'none';
            renderAll();
            
            // Switch to tickets tab - find the correct tab
            const tabs = document.querySelectorAll('.nav-tab');
            const ticketsTab = Array.from(tabs).find(tab => tab.textContent.includes('×§×¨×™××•×ª'));
            if (ticketsTab) {
                showSection('tickets', ticketsTab);
            }
        }

        function sendEmailToUser() {
            const email = document.getElementById('email').value;
            const subject = document.getElementById('subject').value || '×§×¨×™××” ×—×“×©×”';
            if (!email) {
                showToast('error', '× × ×œ×”×–×™×Ÿ ×›×ª×•×‘×ª ××™×™×œ');
                return;
            }
            const body = `×©×œ×•×,\n\n×§×¨×™××ª×š ×”×ª×§×‘×œ×” ×‘××¢×¨×›×ª.\n× ×•×©×: ${subject}\n\n× ×¦×™×’ ×™×—×–×•×¨ ××œ×™×š ×‘×”×§×“×.\n\n×‘×‘×¨×›×”,\n××—×œ×§×ª IT`;
            window.location.href = `mailto:${email}?subject=××™×©×•×¨ ×§×‘×œ×ª ×§×¨×™××” - ${subject}&body=${encodeURIComponent(body)}`;
        }

        function openTicketModal(id) {
            currentTicketId = id;
            const t = tickets.find(x => x.id === id);
            if (!t) return;
            document.getElementById('modalTicketId').textContent = '×§×¨×™××” ' + t.id;
            document.getElementById('ticketModalBody').innerHTML = 
                '<div class="ticket-meta"><span>ğŸ‘¤ ' + t.requesterName + '</span><span>ğŸ¢ ' + t.department + '</span><span>ğŸ“ <a href="tel:' + t.phone + '">' + t.phone + '</a></span><span>ğŸ“§ ' + (t.email || '') + '</span><span>ğŸ“… ' + formatDateTime(t.createdAt) + '</span></div>' +
                '<div class="form-grid" style="margin-bottom:1.5rem">' +
                    '<div class="form-group"><label class="form-label">×¡×˜×˜×•×¡</label><select class="form-select" id="editStatus"><option value="open"' + (t.status==='open'?' selected':'') + '>×¤×ª×•×—</option><option value="progress"' + (t.status==='progress'?' selected':'') + '>×‘×˜×™×¤×•×œ</option><option value="resolved"' + (t.status==='resolved'?' selected':'') + '>×˜×•×¤×œ</option><option value="closed"' + (t.status==='closed'?' selected':'') + '>×¡×’×•×¨</option></select></div>' +
                    '<div class="form-group"><label class="form-label">×¢×“×™×¤×•×ª</label><select class="form-select" id="editPriority"><option value="low"' + (t.priority==='low'?' selected':'') + '>× ××•×š</option><option value="medium"' + (t.priority==='medium'?' selected':'') + '>×‘×™× ×•× ×™</option><option value="high"' + (t.priority==='high'?' selected':'') + '>×’×‘×•×”</option><option value="critical"' + (t.priority==='critical'?' selected':'') + '>×§×¨×™×˜×™</option></select></div>' +
                    '<div class="form-group"><label class="form-label">×”×§×¦××”</label><select class="form-select" id="editAssignee"><option value="">×œ× ×”×•×§×¦×”</option>' + contacts.map(c => '<option value="' + c.name + '"' + (t.assignee===c.name?' selected':'') + '>' + c.name + '</option>').join('') + '</select></div>' +
                '</div>' +
                '<div class="detail-section"><h3>ğŸ“ ×ª×™××•×¨</h3><div class="detail-content">' + t.description + '</div></div>' +
                '<div class="detail-section"><h3>ğŸ’¬ ×”×¢×¨×” ×—×“×©×”</h3><textarea class="form-textarea" id="newComment" rows="3"></textarea></div>' +
                '<div class="detail-section"><h3>ğŸ“œ ×”×™×¡×˜×•×¨×™×”</h3><div class="timeline">' + (t.timeline||[]).slice().reverse().map(i => '<div class="timeline-item ' + i.type + '"><div class="timeline-content"><div class="timeline-header"><span class="timeline-author">' + i.author + '</span><span class="timeline-date">' + formatDateTime(i.timestamp) + '</span></div><div class="timeline-text">' + i.text + '</div></div></div>').join('') + '</div></div>';
            document.getElementById('ticketModal').classList.add('active');
        }

        function saveTicketChanges() {
            const t = tickets.find(x => x.id === currentTicketId);
            if (!t) return;
            const newStatus = document.getElementById('editStatus').value;
            const newPriority = document.getElementById('editPriority').value;
            const newAssignee = document.getElementById('editAssignee').value;
            const comment = document.getElementById('newComment').value;
            const changes = [];
            if (t.status !== newStatus) { changes.push('×¡×˜×˜×•×¡: '+getStatusLabel(newStatus)); t.status = newStatus; if(newStatus==='closed') t.closedAt = new Date().toISOString(); }
            if (t.priority !== newPriority) { changes.push('×¢×“×™×¤×•×ª: '+getPriorityLabel(newPriority)); t.priority = newPriority; }
            if (t.assignee !== newAssignee) { changes.push('×”×§×¦××”: '+(newAssignee||'×œ× ×”×•×§×¦×”')); t.assignee = newAssignee; }
            if (changes.length) t.timeline.push({type:'status',author:'××¢×¨×›×ª',text:changes.join(', '),timestamp:new Date().toISOString()});
            if (comment.trim()) t.timeline.push({type:'comment',author:'×˜×›× ××™',text:comment,timestamp:new Date().toISOString()});
            t.updatedAt = new Date().toISOString();
            saveTickets();
            closeModal('ticketModal');
            renderAll();
            showToast('success', '×”×§×¨×™××” ×¢×•×“×›× ×”');
        }

        function openAddReminderModal() {
            document.getElementById('reminderTitle').value = '';
            document.getElementById('reminderDateTime').value = '';
            document.getElementById('reminderNotes').value = '';
            document.getElementById('reminderTicket').innerHTML = '<option value="">×œ×œ×</option>' + tickets.filter(t=>t.status!=='closed').map(t=>`<option value="${t.id}">${t.id}</option>`).join('');
            document.getElementById('reminderModal').classList.add('active');
        }

        function saveReminder() {
            const title = document.getElementById('reminderTitle').value;
            const dt = document.getElementById('reminderDateTime').value;
            if (!title || !dt) { showToast('error','××œ× ×©×“×•×ª'); return; }
            reminders.push({id:'r'+Date.now(),title,dateTime:dt,ticketId:document.getElementById('reminderTicket').value,notes:document.getElementById('reminderNotes').value,completed:false});
            saveReminders();
            closeModal('reminderModal');
            renderReminders();
            updateStats();
            showToast('success','×ª×–×›×•×¨×ª × ×•×¡×¤×”');
        }

        function completeReminder(id) { const r = reminders.find(x=>x.id===id); if(r){r.completed=true; saveReminders(); renderReminders(); updateStats();} }

        function openAddContactModal() {
            ['contactName','contactRole','contactPhone','contactEmail','contactCategoryOther'].forEach(id=>document.getElementById(id).value='');
            document.getElementById('contactCategory').value = '';
            document.getElementById('contactCategoryOther').style.display = 'none';
            document.getElementById('contactModal').classList.add('active');
        }

        function saveContact() {
            const name = document.getElementById('contactName').value;
            const role = document.getElementById('contactRole').value;
            var category = document.getElementById('contactCategory').value;
            const phone = document.getElementById('contactPhone').value;
            
            // If "××—×¨" selected, use the custom category
            if (category === '××—×¨') {
                const customCategory = document.getElementById('contactCategoryOther').value.trim();
                if (!customCategory) {
                    showToast('error', '× × ×œ××œ× ××ª ×”×§×˜×’×•×¨×™×” ×”××•×ª×××ª ××™×©×™×ª');
                    return;
                }
                category = customCategory;
            }
            
            if (!name||!role||!category||!phone) { 
                showToast('error','× × ×œ××œ× ××ª ×›×œ ×”×©×“×•×ª'); 
                return; 
            }
            
            contacts.push({
                id:'c'+Date.now(),
                name,
                role,
                category,
                phone,
                email:document.getElementById('contactEmail').value
            });
            saveContacts();
            closeModal('contactModal');
            renderContacts();
            populateAssigneeDropdown();
            showToast('success','××™×© ×§×©×¨ × ×•×¡×£');
        }

        function openContactActions(id) {
            const contact = contacts.find(c => c.id === id);
            if (!contact) return;
            currentContactForAction = contact;
            document.getElementById('contactActionName').textContent = contact.name;
            document.getElementById('contactActionsModal').classList.add('active');
        }

        function contactAction(action) {
            if (!currentContactForAction) return;
            const phone = currentContactForAction.phone.replace(/-/g, '');
            const email = currentContactForAction.email;
            
            switch(action) {
                case 'call':
                    window.location.href = 'tel:' + phone;
                    break;
                case 'whatsapp':
                    window.open('https://wa.me/972' + phone.substring(1), '_blank');
                    break;
                case 'email':
                    if (email) {
                        window.location.href = 'mailto:' + email;
                    } else {
                        showToast('error', '××™×Ÿ ×›×ª×•×‘×ª ××™×™×œ ×œ××™×© ×§×©×¨ ×–×”');
                    }
                    break;
                case 'sms':
                    window.location.href = 'sms:' + phone;
                    break;
            }
            closeModal('contactActionsModal');
        }

        function populateAssigneeDropdown() {
            document.getElementById('assignee').innerHTML = '<option value="">×œ× ×”×•×§×¦×”</option>' + technicians.map(t=>`<option value="${t.name}">${t.name}</option>`).join('');
        }

        function openAddTechnicianModal() {
            document.getElementById('techName').value = '';
            document.getElementById('techRole').value = '';
            document.getElementById('techPhone').value = '';
            document.getElementById('techEmail').value = '';
            document.getElementById('techSpecialty').value = '';
            document.getElementById('technicianModal').classList.add('active');
        }

        function saveTechnician() {
            const name = document.getElementById('techName').value.trim();
            const role = document.getElementById('techRole').value.trim() || '×˜×›× ××™';
            const phone = document.getElementById('techPhone').value.trim();
            const email = document.getElementById('techEmail').value.trim();
            const specialty = document.getElementById('techSpecialty').value.trim();
            
            if (!name || !phone || !email) {
                showToast('error', '× × ×œ××œ× ×©×, ×˜×œ×¤×•×Ÿ ×•××™×™×œ');
                return;
            }
            
            technicians.push({
                id: 't' + Date.now(),
                name: name,
                role: role,
                phone: phone,
                email: email,
                specialty: specialty
            });
            
            saveTechnicians();
            closeModal('technicianModal');
            renderTechnicians();
            populateAssigneeDropdown();
            showToast('success', '×˜×›× ××™ × ×•×¡×£ ×‘×”×¦×œ×—×”');
        }

        var assigningTicketId = null;

        function saveAssignment() {
            if (!assigningTicketId) return;
            
            var ticket = tickets.find(function(t) { return t.id === assigningTicketId; });
            if (!ticket) return;
            
            var newAssignee = document.getElementById('assignTechnicianSelect').value;
            
            if (ticket.assignee !== newAssignee) {
                ticket.assignee = newAssignee;
                ticket.updatedAt = new Date().toISOString();
                ticket.timeline.push({
                    type: 'status',
                    author: '××¢×¨×›×ª',
                    text: '×”×•×§×¦×” ×œ×˜×›× ××™: ' + (newAssignee || '×œ× ×”×•×§×¦×”'),
                    timestamp: new Date().toISOString()
                });
                saveTickets();
                renderTickets();
                showToast('success', '×”×˜×›× ××™ ×”×•×§×¦×” ×‘×”×¦×œ×—×”');
            }
            
            closeModal('assignModal');
            assigningTicketId = null;
        }

        function renderTechnicians() {
            var grid = document.getElementById('techniciansGrid');
            if (technicians.length === 0) {
                grid.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ‘¨â€ğŸ’»</div><h3>××™×Ÿ ×˜×›× ××™×</h3><p>×”×•×¡×£ ×˜×›× ××™ ×—×“×© ×›×“×™ ×œ×”×§×¦×•×ª ×œ×• ×§×¨×™××•×ª</p></div>';
                return;
            }
            var html = '';
            for (var i = 0; i < technicians.length; i++) {
                var t = technicians[i];
                html += '<div class="contact-card">';
                html += '<button class="btn-delete contact-delete" data-delete-technician="' + t.id + '" title="××—×§">âœ•</button>';
                html += '<div class="contact-avatar" style="background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%); color: white;">' + getInitials(t.name) + '</div>';
                html += '<div class="contact-info">';
                html += '<h4>' + t.name + '</h4>';
                html += '<p>' + (t.role || '×˜×›× ××™') + (t.specialty ? ' â€¢ ' + t.specialty : '') + '</p>';
                html += '<span style="color: var(--primary)">' + t.phone + '</span>';
                html += '<div style="font-size: 0.8rem; color: var(--gray-500); margin-top: 0.25rem;">' + t.email + '</div>';
                html += '</div></div>';
            }
            grid.innerHTML = html;
        }

        function saveTechnicians() {
            localStorage.setItem('hd_technicians', JSON.stringify(technicians));
        }

        function loadSettings() {
            document.getElementById('orgName').value = settings.orgName || '××’×£ ×”××™×—×©×•×‘';
            document.getElementById('ticketPrefix').value = settings.ticketPrefix || 'IT';
            document.getElementById('systemEmail').value = settings.systemEmail || '';
            document.getElementById('helpdeskEmail').value = settings.helpdeskEmail || '';
            document.getElementById('reminderHours').value = settings.reminderHours || 168;
            
        }

        function saveSettings() {
            settings = {
                orgName: document.getElementById('orgName').value,
                ticketPrefix: document.getElementById('ticketPrefix').value,
                systemEmail: document.getElementById('systemEmail').value,
                helpdeskEmail: document.getElementById('helpdeskEmail').value,
                reminderHours: parseInt(document.getElementById('reminderHours').value) || 168
            };
            localStorage.setItem('hd_settings', JSON.stringify(settings));
            showToast('success','× ×©××¨');
        }

        // History export functions
        function exportHistoryToExcel() {
            const closed = tickets.filter(t => t.status === 'closed');
            if (closed.length === 0) {
                showToast('error', '××™×Ÿ × ×ª×•× ×™× ×œ×™×™×¦×•×');
                return;
            }
            
            let csv = '\uFEFF'; // BOM for Hebrew
            csv += '××¡×¤×¨ ×§×¨×™××”,× ×•×©×,×¤×•×ª×— ×”×§×¨×™××”,××—×œ×§×”,×§×˜×’×•×¨×™×”,×ª××¨×™×š ×¤×ª×™×—×”,×ª××¨×™×š ×¡×’×™×¨×”,×–××Ÿ ×˜×™×¤×•×œ\n';
            
            closed.forEach(t => {
                const diff = Math.round((new Date(t.closedAt) - new Date(t.createdAt)) / 3600000);
                const timeStr = diff < 24 ? diff + ' ×©×¢×•×ª' : Math.round(diff/24) + ' ×™××™×';
                csv += `"${t.id}","${t.subject}","${t.requesterName}","${t.department}","${getCategoryLabel(t.category)}","${formatDate(t.createdAt)}","${formatDate(t.closedAt)}","${timeStr}"\n`;
            });
            
            downloadFile(csv, 'history_' + new Date().toISOString().split('T')[0] + '.csv', 'text/csv;charset=utf-8');
            showToast('success', '×”×§×•×‘×¥ ×”×•×¨×“ ×‘×”×¦×œ×—×”');
        }

        function saveHistoryAsFile() {
            const closed = tickets.filter(t => t.status === 'closed');
            if (closed.length === 0) {
                showToast('error', '××™×Ÿ × ×ª×•× ×™× ×œ×©××™×¨×”');
                return;
            }
            downloadFile(JSON.stringify(closed, null, 2), 'history_backup_' + new Date().toISOString().split('T')[0] + '.json', 'application/json');
            showToast('success', '×”×§×•×‘×¥ × ×©××¨');
        }

        function sendHistoryByEmail() {
            const closed = tickets.filter(t => t.status === 'closed');
            if (closed.length === 0) {
                showToast('error', '××™×Ÿ × ×ª×•× ×™× ×œ×©×œ×™×—×”');
                return;
            }
            
            let body = '×”×™×¡×˜×•×¨×™×™×ª ×§×¨×™××•×ª ×¡×’×•×¨×•×ª:\n\n';
            closed.slice(0, 20).forEach(t => {
                body += `${t.id} - ${t.subject} (${t.requesterName}) - × ×¡×’×¨: ${formatDate(t.closedAt)}\n`;
            });
            if (closed.length > 20) body += `\n... ×•×¢×•×“ ${closed.length - 20} ×§×¨×™××•×ª`;
            
            window.open('mailto:?subject=' + encodeURIComponent('×”×™×¡×˜×•×¨×™×™×ª ×§×¨×™××•×ª - ' + settings.orgName) + '&body=' + encodeURIComponent(body));
        }

        function exportAllData() {
            const data = { 
                tickets, 
                contacts, 
                reminders, 
                settings, 
                technicianEmails,
                ticketCounter,
                exportDate: new Date().toISOString()
            };
            downloadFile(JSON.stringify(data, null, 2), 'helpdesk_backup_' + new Date().toISOString().split('T')[0] + '.json', 'application/json');
            showToast('success', '×’×™×‘×•×™ × ×©××¨ ×‘×”×¦×œ×—×”');
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file'; 
            input.accept = '.json';
            input.onchange = e => {
                const reader = new FileReader();
                reader.onload = ev => {
                    try {
                        const data = JSON.parse(ev.target.result);
                        if(data.tickets) tickets = data.tickets;
                        if(data.contacts) contacts = data.contacts;
                        if(data.reminders) reminders = data.reminders;
                        if(data.settings) settings = data.settings;
                        if(data.technicianEmails) technicianEmails = data.technicianEmails;
                        if(data.ticketCounter) ticketCounter = data.ticketCounter;
                        saveAll(); 
                        loadSettings(); 
                        renderAll();
                        
                        showToast('success','× ×ª×•× ×™× ×™×•×‘××• ×‘×”×¦×œ×—×”');
                    } catch(err) { 
                        showToast('error','×©×’×™××” ×‘×§×¨×™××ª ×”×§×•×‘×¥'); 
                    }
                };
                reader.readAsText(e.target.files[0]);
            };
            input.click();
        }

        function downloadFile(content, filename, type) {
            const blob = new Blob([content], {type: type});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }







        // Auto reminder for delayed tickets
        function checkDelayedTickets() {
            const now = new Date();
            const hours = settings.reminderHours || 168; // Changed to 168 hours (1 week)
            var overdueTickets = [];
            
            tickets.forEach(t => {
                if (t.status === 'open' || t.status === 'progress') {
                    const created = new Date(t.createdAt);
                    const diffHours = (now - created) / (1000 * 60 * 60);
                    
                    if (diffHours >= hours) {
                        overdueTickets.push({
                            id: t.id,
                            subject: t.subject,
                            hours: Math.floor(diffHours),
                            assignee: t.assignee || '×œ× ×”×•×§×¦×”'
                        });
                        
                        if (!t.delayNotificationSent && t.email) {
                            // Mark as sent and add timeline
                            t.delayNotificationSent = true;
                            t.timeline.push({
                                type: 'status',
                                author: '××¢×¨×›×ª',
                                text: '× ×©×œ×—×” ×”×•×“×¢×ª ×¢×™×›×•×‘ ×œ××©×ª××©',
                                timestamp: now.toISOString()
                            });
                        }
                    }
                }
            });
            
            // Show popup reminder if there are overdue tickets
            if (overdueTickets.length > 0) {
                var message = 'ğŸš¨ ×”×ª×¨×¢×ª ×ª×–×›×•×¨×ª!\n\n';
                message += overdueTickets.length + ' ×§×¨×™××•×ª ×©× ×ª×§×¢×• ×™×•×ª×¨ ××©×‘×•×¢:\n\n';
                
                overdueTickets.forEach(ticket => {
                    var days = Math.floor(ticket.hours / 24);
                    message += 'â€¢ ' + ticket.id + ': ' + ticket.subject + '\n';
                    message += '  × ×¤×ª×— ×œ×¤× ×™: ' + days + ' ×™××™×\n';
                    message += '  ×”×•×§×¦×” ×œ: ' + ticket.assignee + '\n\n';
                });
                
                message += '×”×× ×œ×¢×‘×•×¨ ×œ×œ×©×•× ×™×ª ×”×§×¨×™××•×ª?';
                
                if (confirm(message)) {
                    // Switch to tickets tab
                    showSection('tickets', document.querySelector('[onclick="showSection(\'tickets\', this)"]'));
                }
            }
            
            saveTickets();
        }

        function getInitials(name) { return name ? name.split(' ').map(n=>n[0]).join('').slice(0,2) : '??'; }
        function formatDate(d) { return d ? new Date(d).toLocaleDateString('he-IL') : ''; }
        function formatDateTime(d) { return d ? new Date(d).toLocaleDateString('he-IL')+' '+new Date(d).toLocaleTimeString('he-IL',{hour:'2-digit',minute:'2-digit'}) : ''; }
        function getPriorityLabel(p) { return {critical:'ğŸ”´ ×§×¨×™×˜×™',high:'ğŸŸ  ×’×‘×•×”',medium:'ğŸŸ¡ ×‘×™× ×•× ×™',low:'ğŸŸ¢ × ××•×š'}[p]||p; }
        function getStatusLabel(s) { return {open:'×¤×ª×•×—',progress:'×‘×˜×™×¤×•×œ',resolved:'×˜×•×¤×œ',closed:'×¡×’×•×¨'}[s]||s; }
        function getCategoryLabel(c) { return {hardware:'ğŸ’» ×—×•××¨×”',software:'ğŸ“€ ×ª×•×›× ×”',network:'ğŸŒ ×¨×©×ª',security:'ğŸ”’ ××‘×˜×—×”',other:'ğŸ“Œ ××—×¨'}[c]||c; }
        function closeModal(id) { document.getElementById(id).classList.remove('active'); }

        function showToast(type, title, msg='') {
            const toast = document.createElement('div');
            toast.className = 'toast '+type;
            toast.innerHTML = `<span style="font-size:1.25rem">${{success:'âœ…',error:'âŒ',warning:'âš ï¸'}[type]||'â„¹ï¸'}</span><div><strong>${title}</strong>${msg?'<div style="font-size:0.85rem;color:var(--gray-500)">'+msg+'</div>':''}</div>`;
            document.getElementById('toastContainer').appendChild(toast);
            setTimeout(()=>toast.remove(), 4000);
        }

        function saveTickets() { 
            if (SCRIPT_URL) {
                // For local storage - save every change
                localStorage.setItem('hd_tickets', JSON.stringify(tickets));
            } else {
                localStorage.setItem('hd_tickets', JSON.stringify(tickets)); 
            }
        }
        function saveContacts() { localStorage.setItem('hd_contacts', JSON.stringify(contacts)); }
        function saveReminders() { localStorage.setItem('hd_reminders', JSON.stringify(reminders)); }
        function saveAll() { 
            saveTickets(); 
            saveContacts(); 
            saveReminders(); 
            localStorage.setItem('hd_settings',JSON.stringify(settings)); 
            localStorage.setItem('hd_counter',ticketCounter); 
            localStorage.setItem('hd_tech_emails', JSON.stringify(technicianEmails));
        }

        function sendReminderEmail(id) {
            const r = reminders.find(x => x.id === id);
            if (!r) return;
            let em = '';
            if (r.ticketId) {
                const t = tickets.find(x => x.id === r.ticketId);
                if (t && t.email) em = t.email;
            }
            const subject = '×ª×–×›×•×¨×ª: ' + r.title;
            const body = '×©×œ×•×,\n\n×–×•×”×™ ×ª×–×›×•×¨×ª: ' + r.title + '\n\n' + (r.notes || '') + '\n\n××—×œ×§×ª IT';
            window.open('mailto:' + em + '?subject=' + encodeURIComponent(subject) + '&body=' + encodeURIComponent(body));
            showToast('success', '× ×¤×ª×— ×—×œ×•×Ÿ ××™×™×œ');
        }

        function updateEmailTemplate() {
            const helpdeskEmailInput = document.getElementById('helpdeskEmail');
            const displayElement = document.getElementById('displayHelpdeskEmail');
            
            if (helpdeskEmailInput && displayElement) {
                const helpdeskEmail = helpdeskEmailInput.value || 'tickets@company.com';
                displayElement.textContent = helpdeskEmail;
            }
        }

        // API calls for local storage fallback
        function apiCall(action, data) {
            if (!SCRIPT_URL) {
                console.log('No external storage configured, using localStorage');
                return Promise.resolve({success: true});
            }
            
            var params = new URLSearchParams();
            params.append('action', action);
            if (data) {
                params.append('data', JSON.stringify(data));
            }
            
            return fetch(SCRIPT_URL + '?' + params.toString(), {
                method: 'POST'
            })
            .then(function(response) { return response.json(); })
            .catch(function(error) {
                console.error('API Error:', error);
                return {error: error.toString()};
            });
        }
        
        function loadAllData() {
            if (!SCRIPT_URL) {
                return Promise.resolve();
            }
            
            return apiCall('getAll').then(function(result) {
                if (result && !result.error) {
                    if (result.tickets) tickets = result.tickets;
                    if (result.contacts) contacts = result.contacts;
                    if (result.technicians) technicians = result.technicians;
                    if (result.reminders) reminders = result.reminders;
                    if (result.settings) settings = result.settings;
                    console.log('× ×ª×•× ×™× × ×˜×¢× ×• ××”××¢×¨×›×ª:', {
                        tickets: tickets.length,
                        contacts: contacts.length,
                        technicians: technicians.length,
                        reminders: reminders.length
                    });
                }
                return result;
            });
        }

        function populateAssignModal(ticket) {
            console.log('=== DEBUG: ×”×ª×—×œ×ª ××™×œ×•×™ ×¨×©×™××” ===');
            
            var select = document.getElementById('assignTechnician');
            if (!select) {
                console.error('×œ× × ××¦× select element!');
                return;
            }
            
            // Clear completely
            select.innerHTML = '';
            
            // Test 1: Add simple options manually
            console.log('×‘×“×™×§×” 1: ×”×•×¡×¤×ª ××•×¤×¦×™×•×ª ×¤×©×•×˜×•×ª');
            select.innerHTML = '<option value="">×œ× ×”×•×§×¦×”</option><option value="test">×˜×›× ××™ ×‘×“×™×§×”</option>';
            console.log('××—×¨×™ ×”×•×¡×¤×” ×¨××©×•× ×” - innerHTML:', select.innerHTML);
            console.log('××—×¨×™ ×”×•×¡×¤×” ×¨××©×•× ×” - options.length:', select.options.length);
            
            // Test 2: Add technicians if they exist  
            if (technicians && technicians.length > 0) {
                console.log('×‘×“×™×§×” 2: ×”×•×¡×¤×ª ×˜×›× ××™ ×××™×ª×™');
                var tech = technicians[0]; // Take first technician
                console.log('×˜×›× ××™ ×¨××©×•×Ÿ:', tech);
                
                select.innerHTML += '<option value="' + tech.name + '">' + tech.name + ' (×˜×›× ××™)</option>';
                console.log('××—×¨×™ ×”×•×¡×¤×ª ×˜×›× ××™ ×××™×ª×™ - innerHTML:', select.innerHTML);
                console.log('××—×¨×™ ×”×•×¡×¤×ª ×˜×›× ××™ ×××™×ª×™ - options.length:', select.options.length);
                
                // Force visual refresh
                select.style.display = 'none';
                select.offsetHeight; // Force reflow
                select.style.display = 'block';
                
                // Try to force browser to recognize the options
                var event = new Event('change', { bubbles: true });
                select.dispatchEvent(event);
                
                // Wait and check again
                setTimeout(function() {
                    console.log('××—×¨×™ 100ms - innerHTML:', select.innerHTML);
                    console.log('××—×¨×™ 100ms - options.length:', select.options.length);
                    
                    // Force another refresh if needed
                    if (select.options.length > 1) {
                        console.log('âœ… ×”××•×¤×¦×™×•×ª ×¢×“×™×™×Ÿ ×©×');
                        
                        // Manual fix - recreate select element if needed
                        var parent = select.parentNode;
                        var newSelect = select.cloneNode(false);
                        newSelect.innerHTML = select.innerHTML;
                        newSelect.id = select.id;
                        newSelect.className = select.className;
                        newSelect.style.cssText = select.style.cssText;
                        
                        parent.replaceChild(newSelect, select);
                        console.log('âœ… ×¨×©×™××” ×”×•×—×œ×¤×” ×‘×›×¤×™×œ×”');
                    } else {
                        console.error('âŒ ×”××•×¤×¦×™×•×ª × ×¢×œ××•×ª! ×™×© ×‘×¢×™×” ×‘-DOM');
                        alert('×‘×¢×™×”: ×”××•×¤×¦×™×•×ª × ×¢×œ××•×ª ××”×¨×©×™××”!');
                    }
                }, 100);
                
            } else {
                console.log('××™×Ÿ ×˜×›× ××™× ×‘××¢×¨×š');
                select.innerHTML += '<option disabled>××™×Ÿ ×˜×›× ××™×</option>';
            }
            
            console.log('=== ×¡×™×•× ×‘×“×™×§×” ===');
        }

        function saveAssignment() {
            const assignee = document.getElementById('assignTechnician').value;
            const ticket = tickets.find(t => t.id === currentTicketId);
            
            if (ticket) {
                const oldAssignee = ticket.assignee;
                ticket.assignee = assignee;
                ticket.updatedAt = new Date().toISOString();
                
                // Add to timeline
                const text = assignee ? '×”×•×§×¦×” ×œ: ' + assignee : '×”×”×§×¦××” ×‘×•×˜×œ×”';
                ticket.timeline.push({
                    type: 'status',
                    author: '××¢×¨×›×ª',
                    text: text,
                    timestamp: new Date().toISOString()
                });
                
                // Save to local storage
                saveTickets();
                
                if (assignee) {
                    showToast('success', '×”×•×§×¦×” ×œ' + assignee);
                } else {
                    showToast('success', '×”×”×§×¦××” ×‘×•×˜×œ×”');
                }
                
                renderTickets();
                closeModal('assignModal');
            }
        }

        document.querySelectorAll('.modal-overlay').forEach(m => m.addEventListener('click', e => { if(e.target===m) m.classList.remove('active'); }));
        document.addEventListener('keydown', e => { if(e.key==='Escape') document.querySelectorAll('.modal-overlay.active').forEach(m=>m.classList.remove('active')); });

        // ========== Simple Technician Assignment ==========
        var selectedTechForAssignment = '';


        // ========== Simple Working Assignment ==========
        var currentAssignTicketId = '';
        
        
        function saveAssignmentSimple() {
            if (!currentAssignTicketId) return;
            
            const ticket = tickets.find(t => t.id === currentAssignTicketId);
            if (!ticket) return;
            
            const selectedTech = document.getElementById('assignTechSelect').value;
            ticket.assignee = selectedTech;
            ticket.updatedAt = new Date().toISOString();
            
            // ×”×•×¡×£ ×œ×–××Ÿ ×”×˜×™×¤×•×œ
            ticket.timeline.push({
                type: 'status',
                author: '××¢×¨×›×ª',
                text: selectedTech ? '×”×•×§×¦×” ×œ: ' + selectedTech : '×”×”×§×¦××” ×‘×•×˜×œ×”',
                timestamp: new Date().toISOString()
            });
            
            // ×©××•×¨ 
            saveTickets();
            renderTickets();
            closeModal('assignModal');
            
            // ×”×•×“×¢×”
            showToast('success', selectedTech ? '×”×•×§×¦×” ×œ' + selectedTech : '×”×”×§×¦××” ×‘×•×˜×œ×”');
            currentAssignTicketId = '';
        }

        // ========== Single Working Assignment Function ==========
        function openAssignModal(ticketId) {
            alert('×”×¤×•× ×§×¦×™×” ×¢×•×‘×“×ª! ID: ' + ticketId);
            
            currentAssignTicketId = ticketId;
            const ticket = tickets.find(t => t.id === ticketId);
            
            // ×¢×“×›×Ÿ ×›×•×ª×¨×ª
            document.getElementById('assignTicketId').textContent = ticketId + (ticket ? ' - ' + ticket.subject : '');
            
            // ××œ× ×¨×©×™××”
            var select = document.getElementById('assignTechSelect');
            select.innerHTML = '<option value="">×œ× ×”×•×§×¦×”</option>';
            
            alert('×™×© ' + technicians.length + ' ×˜×›× ××™×');
            
            for (var i = 0; i < technicians.length; i++) {
                var tech = technicians[i];
                var option = document.createElement('option');
                option.value = tech.name;
                option.textContent = tech.name;
                if (assigningTicketId) {
                    var currentTicket = tickets.find(function(t) { return t.id === assigningTicketId; });
                    if (currentTicket && currentTicket.assignee === tech.name) {
                        option.selected = true;
                    }
                }
                select.appendChild(option);
            }
            
            // ×¤×ª×— ××ª ×”××•×“×œ
            document.getElementById('assignModal').classList.add('active');
        }

        // ============================================
        // ğŸ“‹ Real Google Forms Integration  
        // ============================================
        
        // ×××–×™×Ÿ ×œ× ×ª×•× ×™× ×—×“×©×™× ×-Google Forms (via localStorage)
        function checkForNewFormsData() {
            const newTicketData = localStorage.getItem('newTicketFromForms');
            
            if (newTicketData) {
                try {
                    const { data, timestamp } = JSON.parse(newTicketData);
                    
                    // ×‘×“×•×§ ×©×”× ×ª×•× ×™× ×—×“×©×™× (×œ× ×™×•×ª×¨ ×-5 ×“×§×•×ª)
                    if (Date.now() - timestamp < 300000) {
                        console.log('ğŸ“§ ×”×ª×§×‘×œ×• × ×ª×•× ×™× ×—×“×©×™× ×-Google Forms:', data);
                        
                        // × ×§×” ××ª ×”× ×ª×•× ×™× ××”-localStorage
                        localStorage.removeItem('newTicketFromForms');
                        
                        // ×¦×•×¨ ×§×¨×™××” ×—×“×©×”
                        processNewFormsTicket(data);
                    }
                } catch (error) {
                    console.error('×©×’×™××” ×‘×¢×™×‘×•×“ × ×ª×•× ×™ Google Forms:', error);
                    localStorage.removeItem('newTicketFromForms'); // × ×§×” ×’× ×‘××§×¨×” ×©×œ ×©×’×™××”
                }
            }
        }
        
        function processNewFormsTicket(data) {
            // ×”××¨ × ×ª×•× ×™ Google Forms ×œ×¤×•×¨××˜ ×”××¢×¨×›×ª
            const ticket = {
                id: 'IT' + ticketCounter.toString().padStart(4, '0'),
                requesterName: data.name || '×œ× ×¦×•×™×Ÿ',
                department: data.department || '',
                phone: data.phone || '',
                email: data.email || '',
                subject: data.subject || '×¤× ×™×™×” ×-Google Forms',
                description: data.description || '',
                category: data.category || 'other',
                priority: data.priority || 'medium',
                status: 'new',
                assignee: '',
                createdAt: data.timestamp || new Date().toISOString(),
                updatedAt: new Date().toISOString(),
                source: 'google_forms',
                timeline: [{
                    type: 'created',
                    author: 'Google Forms',
                    text: '×§×¨×™××” ×”×ª×§×‘×œ×” ×-Google Forms',
                    timestamp: new Date().toISOString()
                }]
            };
            
            // ×”×•×¡×£ ×œ×¨×©×™××ª ×”×§×¨×™××•×ª
            tickets.push(ticket);
            ticketCounter++;
            
            // ×©××•×¨
            saveTickets();
            localStorage.setItem('hd_counter', ticketCounter);
            
            // ×”×¦×’ ×”×ª×¨××” ×¤×©×•×˜×” ×¢× ×¦×œ×™×œ ××¢×¨×›×ª
            showSimpleNotification(ticket);
            
            // ×”×¦×’ Toast
            showToast('success', '×§×¨×™××” ×—×“×©×” ×-Google Forms!', `×-${ticket.requesterName}: ${ticket.subject}`);
            
            // ×¢×“×›×Ÿ UI
            updateStats();
            renderTickets();
        }
        
        // ×”×¦×’×ª ×”×ª×¨××•×ª ××¢×¨×›×ª ×¢× ×¦×œ×™×œ×™×
        function showSystemNotification(ticket) {
            if (Notification.permission !== 'granted') {
                return;
            }
            
            // ×¦×œ×™×œ×™× ×©×•× ×™× ×œ×¤×™ ×¢×“×™×¤×•×ª
            const soundsByPriority = {
                'critical': 'ğŸš¨',
                'high': 'âš ï¸', 
                'medium': 'ğŸ””',
                'low': 'ğŸ’¬'
            };
            
            const icon = soundsByPriority[ticket.priority] || 'ğŸ””';
            const priorityText = getPriorityText(ticket.priority);
            
            // ×”×ª×¨××” ×¢× ×”×’×“×¨×•×ª ××ª×§×“××•×ª
            const notification = new Notification(`${icon} ×§×¨×™××” ${priorityText} ×—×“×©×”!`, {
                body: `ğŸ‘¤ ${ticket.requesterName}\nğŸ“§ ${ticket.subject}\nğŸ¢ ${ticket.department}\nğŸ“ ${ticket.phone}`,
                icon: '/favicon.ico', // ××™×™×§×•×Ÿ ×”××ª×¨
                badge: '/badge.png', // ×ª××•× ×” ×§×˜× ×” ×œ×”×ª×¨××”
                tag: `ticket-${ticket.id}`, // ×œ×× ×™×¢×ª ×›×¤×™×œ×•×™×•×ª
                requireInteraction: notificationSettings.requireInteraction, // ×œ×¤×™ ×”×’×“×¨×•×ª ××©×ª××©
                silent: !notificationSettings.soundEnabled, // ×”×©×ª××© ×‘×¦×œ×™×œ ×œ×¤×™ ×”×’×“×¨×•×ª
                timestamp: Date.now(),
                data: {
                    ticketId: ticket.id,
                    priority: ticket.priority,
                    url: window.location.href + '#ticket-' + ticket.id
                },
                actions: [ // ×›×¤×ª×•×¨×™ ×¤×¢×•×œ×” ××”×™×¨×” (Chrome/Edge)
                    {
                        action: 'view',
                        title: 'ğŸ‘ï¸ ×¦×¤×” ×‘×§×¨×™××”'
                    },
                    {
                        action: 'assign',
                        title: 'ğŸ‘¨â€ğŸ’» ×”×§×¦×” ×˜×›× ××™'
                    }
                ]
            });
            
            // ×˜×™×¤×•×œ ×‘×œ×—×™×¦×” ×¢×œ ×”×”×ª×¨××”
            notification.onclick = function() {
                window.focus(); // ×”×‘× ××ª ×”×—×œ×•×Ÿ ×œ×—×–×™×ª
                showTab('tickets'); // ×¢×‘×•×¨ ×œ×œ×©×•× ×™×ª ×§×¨×™××•×ª
                notification.close(); // ×¡×’×•×¨ ××ª ×”×”×ª×¨××”
                
                // ×”×“×’×© ××ª ×”×§×¨×™××” ×”×—×“×©×”
                setTimeout(() => {
                    highlightNewTicket(ticket.id);
                }, 500);
            };
            
            // ×¡×’×™×¨×” ××•×˜×•××˜×™×ª ×œ×¤×™ ×”×’×“×¨×•×ª ××©×ª××© (××œ× ×× critical ×•-requireInteraction)
            if (ticket.priority !== 'critical' && !notificationSettings.requireInteraction) {
                setTimeout(() => {
                    notification.close();
                }, notificationSettings.duration * 1000);
            }
            
            // × ×’×Ÿ ×¦×œ×™×œ × ×•×¡×£ ×‘×¢×“×™×¤×•×ª ×’×‘×•×”×” (×× ××•×¤×¢×œ ×‘×”×’×“×¨×•×ª)
            if (notificationSettings.urgentSoundEnabled && 
                (ticket.priority === 'critical' || ticket.priority === 'high')) {
                playUrgentAlert();
            }
        }
        
        // × ×’×™× ×ª ×¦×œ×™×œ ×“×—×•×£ × ×•×¡×£
        function playUrgentAlert() {
            // ×¦×•×¨ ×¦×œ×™×œ ×¡×™× ×ª×˜×™ ×“×—×•×£
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // ×¡×“×¨×ª ×‘×™×¤×™× ×“×—×•×¤×”
                const frequencies = [800, 1000, 800, 1200]; // ×ª×“×¨×™× ×©×•× ×™×
                const duration = 200; // ×›×œ ×‘×™×¤ 200ms
                
                frequencies.forEach((freq, index) => {
                    setTimeout(() => {
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();
                        
                        oscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);
                        
                        oscillator.frequency.setValueAtTime(freq, audioContext.currentTime);
                        oscillator.type = 'sine';
                        
                        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration/1000);
                        
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + duration/1000);
                    }, index * 250); // ×¨×•×•×— ×‘×™×Ÿ ×‘×™×¤×™×
                });
                
            } catch (error) {
                console.log('×œ× × ×™×ª×Ÿ ×œ× ×’×Ÿ ×¦×œ×™×œ ×“×—×•×£:', error);
            }
        }
        
        // ×§×‘×œ×ª ×˜×§×¡×˜ ×¢×“×™×¤×•×ª ×‘×¢×‘×¨×™×ª
        function getPriorityText(priority) {
            const priorityTexts = {
                'critical': '×§×¨×™×˜×™×ª ğŸš¨',
                'high': '×’×‘×•×”×” âš ï¸',
                'medium': '×‘×™× ×•× ×™×ª ğŸ””', 
                'low': '× ××•×›×” ğŸ’¬'
            };
            return priorityTexts[priority] || '×¨×’×™×œ×”';
        }
        
        // ×”×“×’×©×ª ×§×¨×™××” ×—×“×©×” ×‘×¨×©×™××”
        function highlightNewTicket(ticketId) {
            const ticketRows = document.querySelectorAll('#ticketsTableBody tr');
            ticketRows.forEach(row => {
                if (row.textContent.includes(ticketId)) {
                    row.style.background = 'linear-gradient(45deg, #fff3cd, #f8f9fa)';
                    row.style.border = '2px solid #ffc107';
                    row.style.animation = 'pulse 3s ease-in-out';
                    
                    // ×”×¡×¨ ×”×“×’×©×” ××—×¨×™ 10 ×©× ×™×•×ª
                    setTimeout(() => {
                        row.style.background = '';
                        row.style.border = '';
                        row.style.animation = '';
                    }, 10000);
                }
            });
        }
        
        // ×”×“×’×©×ª ×œ×©×•× ×™×ª ×”××™×™×œ×™× ×›×©××’×™×¢×” ×§×¨×™××” ×—×“×©×”
        function highlightEmailTab() {
            const emailTab = document.querySelector('button[onclick*="email-tickets"]');
            if (emailTab) {
                emailTab.style.background = 'linear-gradient(45deg, #ff6b6b, #4ecdc4)';
                emailTab.style.color = 'white';
                emailTab.style.animation = 'pulse 2s infinite';
                
                // ×”×¡×¨ ×”×”×“×’×©×” ××—×¨×™ 10 ×©× ×™×•×ª
                setTimeout(() => {
                    emailTab.style.background = '';
                    emailTab.style.color = '';
                    emailTab.style.animation = '';
                }, 10000);
            }
        }
        
        // ============================================
        // ğŸ”” Simple Notification Functions
        // ============================================
        function requestNotifications() {
            const statusEl = document.getElementById('notificationStatus');
            
            if (!('Notification' in window)) {
                statusEl.innerHTML = 'âŒ ×”×“×¤×“×¤×Ÿ ×œ× ×ª×•××š ×‘×”×ª×¨××•×ª';
                statusEl.style.background = '#ffebee';
                return;
            }

            if (Notification.permission === 'granted') {
                statusEl.innerHTML = 'âœ… ×”×ª×¨××•×ª ××•×¤×¢×œ×•×ª ×•×›×•×œ×œ×•×ª ×¦×œ×™×œ ××¢×¨×›×ª';
                statusEl.style.background = '#e8f5e8';
                return;
            }

            statusEl.innerHTML = 'â³ ××‘×§×© ××™×©×•×¨ ×œ×”×ª×¨××•×ª...';
            statusEl.style.background = '#fff3e0';

            Notification.requestPermission().then(permission => {
                if (permission === 'granted') {
                    statusEl.innerHTML = 'âœ… ×”×ª×¨××•×ª ×”×•×¤×¢×œ×•! ×ª×§×‘×œ×• ×”×•×“×¢×” ×¢× ×¦×œ×™×œ ×›×©××’×™×¢×” ×§×¨×™××” ×—×“×©×”';
                    statusEl.style.background = '#e8f5e8';
                    
                    // ×”×•×“×¢×ª ×‘×“×™×§×”
                    new Notification('ğŸ‰ ×”×ª×¨××•×ª ×¤×•×¢×œ×•×ª!', {
                        body: '×ª×§×‘×œ×• ×”×ª×¨××” ×›×©××’×™×¢×” ×§×¨×™××” ×—×“×©×” ×-Google Forms',
                        icon: 'ğŸ””'
                    });
                } else {
                    statusEl.innerHTML = 'âŒ ×”×ª×¨××•×ª × ×“×—×•. × ×¡×• ×©×•×‘ ××• ×”×¤×¢×™×œ×• ×™×“× ×™×ª ×‘×”×’×“×¨×•×ª ×”×“×¤×“×¤×Ÿ';
                    statusEl.style.background = '#ffebee';
                }
            });
        }

        function testSystemNotification() {
            if (Notification.permission !== 'granted') {
                showToast('warning', '×ª×—×™×œ×” ××¤×©×¨×• ×”×ª×¨××•×ª', '');
                requestNotifications();
                return;
            }

            // ×”×ª×¨××ª ×‘×“×™×§×” ×¤×©×•×˜×” ×¢× ×¦×œ×™×œ ××¢×¨×›×ª
            new Notification('ğŸ§ª ×‘×“×™×§×ª ××¢×¨×›×ª', {
                body: '×–×•×”×™ ×”×ª×¨××ª ×‘×“×™×§×”. ×©××¢×ª× ×¦×œ×™×œ?',
                icon: 'ğŸ–¥ï¸',
                requireInteraction: false
            });

            showToast('success', '×”×ª×¨××ª ×‘×“×™×§×” × ×©×œ×—×”', '×©××¢×ª× ×¦×œ×™×œ?');
        }
        
        // ============================================
        // ğŸ“§ ×¤×•× ×§×¦×™×•×ª ×©×™×ª×•×£ ×˜×•×¤×¡
        // ============================================
        function shareFormByEmail() {
            const formUrl = 'https://docs.google.com/forms/d/e/1FAIpQLSfPG-sw7LNKrThP99gZfLKMDD1AKTsXqaBO0A9MJDJ4C3-oyw/viewform?usp=header';
            const subject = '×§×™×©×•×¨ ×œ×¤×ª×™×—×ª ×§×¨×™××” ×‘××¢×¨×›×ª IT';
            const body = `×©×œ×•×,\n\n×œ×¤×ª×™×—×ª ×§×¨×™××” ×—×“×©×” ×‘××¢×¨×›×ª IT, ×× × ××œ××• ××ª ×”×˜×•×¤×¡ ×”×‘×:\n\n${formUrl}\n\n×ª×•×“×”!`;
            
            window.open(`mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`, '_blank');
            showToast('success', '××™×™×œ × ×¤×ª×—', '×©×œ×—×• ×œ×¦×•×•×ª');
        }
        
        function shareFormByWhatsApp() {
            const formUrl = 'https://docs.google.com/forms/d/e/1FAIpQLSfPG-sw7LNKrThP99gZfLKMDD1AKTsXqaBO0A9MJDJ4C3-oyw/viewform?usp=header';
            const message = encodeURIComponent(`×©×œ×•×! ×œ×¤×ª×™×—×ª ×§×¨×™××” ×‘××¢×¨×›×ª IT, ×× × ××œ××• ××ª ×”×˜×•×¤×¡: ${formUrl}`);
            const whatsappUrl = `https://wa.me/?text=${message}`;
            
            window.open(whatsappUrl, '_blank');
            showToast('success', '×•×•×˜×¡××¤ × ×¤×ª×—', '×©×ª×¤×• ××ª ×”×§×™×©×•×¨');
        }
        
        // ×¤×•× ×§×¦×™×” ×œ×¡×™××•×œ×¦×™×” ×©×œ ×§×‘×œ×ª ×§×¨×™××” ×—×“×©×” ×-Google Forms
        function simulateNewTicket() {
            // ×™×¦×™×¨×ª × ×ª×•× ×™ ×“××” ×›××™×œ×• ×”×’×™×¢×• ×-Google Forms
            const sampleData = {
                name: '×“× ×™ ×›×”×Ÿ',
                email: 'danny.cohen@company.com',
                phone: '050-1234567',
                department: '××©××‘×™ ×× ×•×©',
                subject: '×‘×¢×™×” ×‘×”×ª×—×‘×¨×•×ª ×œ××¢×¨×›×ª ×”×©×›×¨',
                description: '×œ× ××¦×œ×™×— ×œ×”×ª×—×‘×¨ ×œ××¢×¨×›×ª ×”×©×›×¨ ×›×‘×¨ ×©×¢×ª×™×™×. ××§×‘×œ ×”×•×“×¢×ª ×©×’×™××” "×¡×™×¡××” ×©×’×•×™×”" ×œ××¨×•×ª ×©×”×¡×™×¡××” × ×›×•× ×”.',
                category: 'access',
                priority: 'high',
                timestamp: new Date().toISOString(),
                source: 'google_forms'
            };
            
            // ×©××™×¨×” ×‘-localStorage ×›××• ×©Google Apps Script ×¢×•×©×”
            localStorage.setItem('newTicketFromForms', JSON.stringify({
                data: sampleData,
                timestamp: Date.now()
            }));
            
            showToast('info', '×¡×™××•×œ×¦×™×” × ×©×œ×—×”', '×¢×›×©×™×• ×”××¢×¨×›×ª ×ª×‘×“×•×§ ×•×ª××¦× ××ª ×”× ×ª×•× ×™×...');
            
            // ×‘×“×™×§×” ××™×™×“×™×ª (×‘××§×•× ×œ×—×›×•×ª 5 ×©× ×™×•×ª)
            setTimeout(() => {
                checkForNewFormsData();
            }, 1000);
        }

        function showSimpleNotification(ticket) {
            if (Notification.permission !== 'granted') {
                return;
            }

            const priorityIcons = {
                'critical': 'ğŸš¨',
                'high': 'âš ï¸',
                'medium': 'ğŸ“§',
                'low': 'ğŸ’¬'
            };

            const icon = priorityIcons[ticket.priority] || 'ğŸ“§';

            new Notification(`${icon} ×§×¨×™××” ×—×“×©×” ×-Google Forms`, {
                body: `ğŸ‘¤ ${ticket.requesterName}\nğŸ“§ ${ticket.subject}\nğŸ¢ ${ticket.department}`,
                icon: 'ğŸ””',
                requireInteraction: true,
                tag: 'new-ticket'
            });
        }
        
        // API Endpoint ×œ×§×‘×œ×ª × ×ª×•× ×™× ×-Google Apps Script
        window.receiveTicketFromGoogleForms = function(ticketData) {
            console.log('ğŸ“§ ×”×ª×§×‘×œ×• × ×ª×•× ×™× ×™×©×™×¨×•×ª ×-Google Forms:', ticketData);
            processNewFormsTicket(ticketData);
        };

    </script>
</body>
</html>